"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5826],{55288:function(e,t,n){var r=n(85893);t.Z=e=>(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",...e,children:(0,r.jsx)("path",{d:"M13 6.5L8 12L3 6.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})},26281:function(e,t,n){var r=n(85893);t.Z=e=>(0,r.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",fillRule:"evenodd",clipRule:"evenodd",...e,children:[(0,r.jsx)("path",{d:"M8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14ZM8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16Z"}),(0,r.jsx)("path",{d:"M8.00002 5C7.23823 5 6.75235 5.42428 6.33207 6.0547L4.66797 4.9453C5.24769 4.07572 6.26181 3 8.00002 3C8.85764 3 9.74527 3.22801 10.4006 3.82095C11.0961 4.45014 11.3871 5.36121 11.24 6.39142C11.0654 7.61316 10.1329 8.20968 9.62788 8.53274C9.61312 8.54219 9.59872 8.5514 9.58471 8.56038C9.28352 8.75365 9.13447 8.85248 9.03752 8.95193C9.01576 8.97425 9.00487 8.98888 9.00006 8.9961C9.00004 8.99719 9.00002 8.99848 9.00002 9V10H7.00002V9C7.00002 8.36831 7.27443 7.89539 7.60537 7.55588C7.87516 7.27912 8.21507 7.06207 8.45012 6.91197C8.46899 6.89992 8.48719 6.8883 8.50461 6.87712C9.08301 6.50598 9.22542 6.35112 9.26007 6.10858C9.32718 5.63879 9.19239 5.42486 9.05886 5.30405C8.88525 5.14699 8.54074 5 8.00002 5Z"}),(0,r.jsx)("circle",{cx:"8",cy:"12",r:"1.25"})]})},69583:function(e,t,n){var r=n(85893);t.Z=e=>(0,r.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",...e,children:[(0,r.jsx)("path",{d:"M6 9.5L3 6L6 2.5",stroke:"currentColor",strokeWidth:"2"}),(0,r.jsx)("path",{d:"M4 6C5.91616 6 7.69217 6 9.49994 6C11.4329 6 13 7.567 13 9.5V9.5C13 11.433 11.433 13 9.5 13H9",stroke:"currentColor",strokeWidth:"2"})]})},47213:function(e,t,n){var r=n(85893);t.Z=e=>(0,r.jsxs)("svg",{viewBox:"0 0 16 16",width:"16",height:"16",fill:"currentColor",...e,children:[(0,r.jsx)("circle",{r:"1.5",cx:"8",cy:"2.5"}),(0,r.jsx)("circle",{r:"1.5",cx:"8",cy:"7.5"}),(0,r.jsx)("circle",{r:"1.5",cx:"8",cy:"12.5"})]})},49847:function(e,t,n){n.d(t,{V:function(){return ej}});var r=n(85893),o=n(5379),a=n.n(o),l=n(7026),i=n(94184),s=n.n(i),c=n(67294),d=n(15100),u=n(56065),p=n(91696),m=n(51337),v=n(71820),f=n(20637),h=n(24067),y=n(94988),g=n(26281),b=n(88903),x=n(36869);let w={sample:{label:null,link:null,examples:[{label:"Reference a cell value",value:"CELL_NAME",readonly:!0},{label:"Reference column",value:'row["COLUMN"]'},{label:"Currency to number",value:'+row["COLUMN"].replace("$", "")'},{label:"Keep only digits",value:"row[\"COLUMN\"].replace(/\\D/g,'')"},{label:"Extract before",value:'row["COLUMN"].split("A")[0]'}]},string:{label:"String operations",link:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String",examples:[{label:"At",value:'row["COLUMN"].at("A")'},{label:"Concat",value:'row["COLUMN"].concat("A")'},{label:"Ends with",value:'row["COLUMN"].endsWith("A")'},{label:"Includes",value:'row["COLUMN"].includes("A")'},{label:"Replace",value:'row["COLUMN"].replace("A", "B")'},{label:"Slice",value:'row["COLUMN"].slice(N)'},{label:"Split",value:'row["COLUMN"].split("expr")[0]'},{label:"Substring",value:'row["COLUMN"].substr(N, N)'},{label:"To Lowercase",value:'row["COLUMN"].toLowerCase()'},{label:"Trim whitespace",value:'row["COLUMN"].trim()'}]},number:{label:"Number operations",link:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math",examples:[{label:"Absolute value",value:'Math.abs(row["COLUMN"])'},{label:"Ceiling",value:'Math.ceil(row["COLUMN"])'},{label:"Cosine",value:'Math.cos(row["COLUMN"])'},{label:"Floor",value:'Math.floor(row["COLUMN"])'},{label:"Log",value:'Math.log(row["COLUMN"])'},{label:"Max",value:'Math.max(row["COLUMN"], VALUE)'},{label:"Random",value:"Math.random()"}]},date:{label:"Date operations",link:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date",examples:[{label:"Get hour",value:'row["COLUMN"].getUTCHour()'},{label:"Get day of month",value:'row["COLUMN"].getUTCDate()'},{label:"Get year",value:'row["COLUMN"].getUTCFullYear()'},{label:"Get day of the week",value:'d3.utcFormat("%A")(row["COLUMN"])'},{label:"Get month name",value:'d3.utcFormat("%B")(row["COLUMN"])'}]}},CodeExampleMenu=()=>{let[e,t]=(0,c.useState)(""),n=(0,c.useMemo)(()=>(0,x.v)(e),[e]),exampleFilter=e=>n.test(e.label)||n.test(e.value);return(0,r.jsxs)(b.v2,{children:[(0,r.jsx)(b.j2,{className:"bg-near-white bn pointer moon-gray flex items-center",style:{width:29,height:29},children:(0,r.jsx)(g.Z,{})}),(0,r.jsx)(b.YI,{children:(0,r.jsxs)("div",{className:"bg-white b--silver mt2 ba br2 shadow-4 outline-0",children:[(0,r.jsx)("div",{className:"bb b--silver pa2",children:"Write an expression to be evaluated once per row."}),(0,r.jsxs)("div",{className:"flex items-center pa2",children:[(0,r.jsx)("div",{className:"gray f7 mb2",style:{width:"150px"},children:"Examples"}),(0,r.jsx)("div",{style:{flex:1},className:"near-black lh-copy relative flex items-center bg-near-white",children:(0,r.jsx)(h.x,{type:"text",placeholder:"Search examples...",value:e,onChange:e=>{let{target:{value:n}}=e;return t(n)},className:"flex-auto bg-transparent bn",style:{backgroundColor:"var(--near-white)"},leftElement:(0,r.jsx)(v.Z,{className:"db moon-gray bg-near-white bn"})})})]}),(0,r.jsx)("div",{style:{maxHeight:200},className:"ph2 overflow-y-scroll",children:Object.entries(w).map(e=>{let[t,{label:o,link:a,examples:l}]=e,i=n.test(t)?l:l.filter(exampleFilter);return i.length?(0,r.jsxs)("div",{children:[o&&(0,r.jsx)("div",{className:"bt b--silver pt2 gray",children:o}),i.map(e=>{let{label:t,value:n,readonly:o}=e;return(0,r.jsxs)("div",{className:"pv1 mv2 flex copy-container f6",children:[(0,r.jsx)("div",{style:{width:"150px"},children:t}),(0,r.jsxs)("div",{className:"ml1 code flex",children:[(0,r.jsx)("code",{dangerouslySetInnerHTML:{__html:f.Z.highlight(n,{language:"js"}).value}}),!0!==o&&(0,r.jsx)("button",{className:"copy mr-auto bg-transparent nt1 nb1 squishy pointer bn gray flex items-center br2",title:"Copy derivation code",onClick:e=>{e.stopPropagation(),navigator.clipboard.writeText(n)},children:(0,r.jsx)(y.Z,{})})]})]},t)}),a&&(0,r.jsx)("div",{className:"gray f7 mb2",children:(0,r.jsxs)("a",{href:a,target:"_blank",rel:"noreferrer",children:["See JavaScript docs for additional ",t," methods and information"]})})]},t):null})})]})})]})};var k=n(45383),j=n(58037),C=n(59119),S=n(78120),M=n(14456),R=n(35524);let N=M.tk.theme({"&":{color:"var(--syntax-normal)",wordBreak:"break-word",borderLeft:"solid ".concat(4,"px transparent")},"&.cm-focused":{outline:"none !important"},"&.cm-focused .cm-activeLine":{borderLeft:"solid ".concat(4,"px var(--observable-focus-blue)"),marginLeft:"-".concat(4,"px")},"&.cm-focused .cm-activeLine.cm-errorLine":{borderLeftColor:"var(--dark-red)"},"&.cm-focused .cm-matchingBracket":{backgroundColor:"transparent",color:"var(--syntax-matchbracket)"},".cm-scroller":{font:"var(--monospace-font)",overflow:"initial"},".cm-matchingBracket, &:not(.cm-focused) .cm-selectionMatch":{backgroundColor:"transparent"},".cm-line":{padding:"0 2px 0 4px","&:first-child":{marginRight:"20px"}},".cm-activeLine":{backgroundColor:"inherit"},".cm-matchingBracket, .cm-nonmatchingBracket":{color:"inherit"}}),FormulaEditor=e=>{let{editingColumnName:t,setFormula:n,formula:o,saveDeriveColumn:a}=e,l=(0,c.useMemo)(()=>new S.F6,[]),i=(0,c.useRef)(null),[s,d]=(0,c.useState)(),u=(0,c.useCallback)(e=>{a(t,e)},[t,a]);return(0,c.useEffect)(()=>{var e;let t=M.tk.updateListener.of(e=>{e.docChanged&&n(e.state.doc.toString())}),r=S.yy.create({extensions:[(0,j.eJ)(),(0,k.m8)(),(0,C.nF)(R.$d),N,t,(0,M.W$)("Column formula..."),S.yy.transactionFilter.of(e=>e.newDoc.lines>1?[]:e),l.of(M.$f.of([...k.wQ,...k.f$]))]}),o=new M.tk({state:r});return d(o),null===(e=i.current)||void 0===e||e.appendChild(o.dom),o.focus(),()=>{o.destroy()}},[n,l]),(0,c.useEffect)(()=>{void 0!==s&&(0===s.state.doc.length&&o?s.dispatch({changes:{from:0,to:s.state.doc.length,insert:o},selection:{anchor:o.length}}):void 0===o&&s.dispatch({changes:{from:0,insert:'row["COLUMN"]'},selection:{anchor:5,head:11}}))},[s,o]),(0,c.useEffect)(()=>{null==s||s.dispatch({effects:l.reconfigure(M.$f.of([...k.wQ,...k.f$,{key:"Shift-Enter",run:e=>(u(e.state.doc.toString()),!1)}]))})},[s,u,l]),(0,r.jsx)("div",{ref:i})};var _=n(7138),D=n(80583),E=n(71183),O=n(42962),L=n(60147);let TableBodyCellMenu=e=>{let{node:t,value:n,formattedValue:o,displayValue:a,columnName:l,columnSummary:i,error:c}=e,d=(0,O.O$)(i.type,n),u=(0,L.I0)();return(0,r.jsxs)(D.v2,{children:[(0,r.jsxs)(b.j2,{className:s()(i.type,c&&"mid-gray bg-lightest-red flex items-center","w-100 h-100 bn bg-transparent pointer"),title:o,style:{font:"inherit",fontVariantNumeric:"inherit",padding:"4px 6px",textAlign:"inherit"},children:[c&&(0,r.jsx)(E.Z,{washed:!0,width:14,height:14,className:"mr1"}),a]}),(0,r.jsx)(D.YI,{className:"bg-white ba b--silver br2 shadow-4 outline-0 overflow-auto","data-cy":"cell-filter-popover",children:(0,r.jsxs)(b.sd,{children:[(0,r.jsx)(b.sN,{onSelect:async()=>await navigator.clipboard.writeText(o),children:(0,r.jsxs)("div",{className:"flex items-center pv1",children:[(0,r.jsx)(y.Z,{className:"mr1"}),"Copy value"]})}),(0,r.jsx)("div",{className:"bt b--light-gray"}),(0,r.jsxs)("div",{className:"gray ph3 pv2 f7",children:["Filter ",(0,r.jsx)("span",{className:"fw6",children:l})," by value"]}),d.map(e=>(0,r.jsx)(b.sN,{style:{fontWeight:500,maxWidth:300},onSelect:()=>{var r;let o;return r=i.type,void(o="v"===e||"nv"===e?{type:"primitive",value:r}:"date"===i.type?{type:"date",value:Number(n)}:{type:"primitive",value:n},u({id:t.id,type:"setDataOperations",operations:{filter:[...t.data.operations.filter,{type:e,operands:[{type:"column",value:l},o]}]}}))},children:(0,r.jsx)("div",{className:"truncate",children:"".concat((0,O.a8)(e,i.type)).concat("v"!==e&&"nv"!==e?" ".concat(o):"")})},e))]})})]})},I=(0,c.memo)(function(e){let{data:t,node:n,summary:o,hoveredCell:l,setHoveredCell:i,colWidths:c,searchInfo:d,editingColumn:u,allowDerivedColumns:p}=e,{mode:m}=n;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("tbody",{className:a().dynamic([["7c0ce4f72d0d3120",[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]])+" "+(s()("table"===m&&"pointer")||""),children:null==t?void 0:t.rows.map((e,v)=>{let f=new Map(d?d[v].matches:[]);return(0,r.jsxs)("tr",{"data-cy":"cell-table-result-row",onPointerEnter:()=>i({row:v}),onPointerLeave:()=>i(void 0),className:a().dynamic([["7c0ce4f72d0d3120",[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]]),children:[(0,r.jsx)("td",{className:a().dynamic([["7c0ce4f72d0d3120",[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]]),children:d?d[v].index:v}),o&&Array.from(o.columns,(o,d)=>{var h,y;let[g,b]=o,x=null===(h=t.operations.sort)||void 0===h?void 0:h.find(e=>{let{column:t}=e;return t===g}),w=(0,O.t2)(g,t.operations),k=x||w,j=u===g,C=e[g],S=(0,_.getTypeValidator)(b.type),M=S(C)?(0,O.QI)(b.type)(C):C instanceof Error?"<unavailable>":"".concat(C),R=f.get(g)?function(e,t){if(!e)return e;let n=new Set(t.map(e=>Array.from({length:e[1]-e[0]},(t,n)=>n+e[0])).flat()),o=[];for(let t=0;t<e.length;t++){let r=n.has(t),a=o.length>0?o[o.length-1]:null;(null==a?void 0:a.highlighted)===r?a.part+=e[t]:o.push({highlighted:r,part:e[t]})}return o.map((e,t)=>{let{highlighted:n,part:o}=e;return n?(0,r.jsx)("span",{className:"b",children:o},"".concat(o).concat(t)):o})}(M,f.get(g)):M,N=(null==c?void 0:c.get(g))||150,D=(null==l?void 0:l.column)===g&&l.row===v,L=null===(y=b.errors)||void 0===y?void 0:y.get(v),I="table"===m&&D&&!j;return(0,r.jsx)("td",{style:I?{backgroundColor:"var(--light-silver)",border:"1px solid var(--moon-gray)"}:void 0,title:null!=L?L:7*M.length>N?M:void 0,onPointerEnter:()=>i({column:g,row:v}),onPointerLeave:()=>i(void 0),className:a().dynamic([["7c0ce4f72d0d3120",[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]])+" "+(s()(L?"bg-washed-red":j?(null==l?void 0:l.row)===v?"bg-observable-focus-light-blue":"bg-observable-focus-lightest-blue":k?"bg-washed-yellow":"",b.type,S(C)&&""!==C?"":"gray fw4",L&&"error")||""),children:I?(0,r.jsx)(TableBodyCellMenu,{node:n,value:C,formattedValue:M,displayValue:R,columnName:g,columnSummary:b,error:L}):L?(0,r.jsxs)("div",{style:{padding:"4px 6px"},className:a().dynamic([["7c0ce4f72d0d3120",[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]])+" flex items-center mid-gray",children:[L&&(0,r.jsx)(E.Z,{washed:!0,width:14,height:14,className:"mr1"}),R]}):(0,r.jsx)("div",{style:{padding:"4px 6px"},className:a().dynamic([["7c0ce4f72d0d3120",[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]]),children:R})},d)}),(0,r.jsx)("td",{style:{width:"99%",...p?{borderLeft:"none",borderRight:"none"}:null},className:a().dynamic([["7c0ce4f72d0d3120",[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]])}),"table"===m&&p&&(0,r.jsx)("td",{style:{width:"40px",borderLeft:"none"},className:a().dynamic([["7c0ce4f72d0d3120",[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]])})]},v)})}),(0,r.jsx)(a(),{id:"7c0ce4f72d0d3120",dynamic:[p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""],children:"tbody.__jsx-style-dynamic-selector{max-height:300px;overflow-y:scroll}td.__jsx-style-dynamic-selector{padding:0px;border:1px solid var(--light-silver);border-bottom:solid 1px transparent;border-right:solid 1px transparent;white-space:nowrap;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}tr.__jsx-style-dynamic-selector:hover{background-color:var(--near-white)}tr.__jsx-style-dynamic-selector:hover>td.error.__jsx-style-dynamic-selector{background-color:var(--lightest-red)}tr.__jsx-style-dynamic-selector:first-child td.__jsx-style-dynamic-selector{border-top:solid 1px transparent}td.__jsx-style-dynamic-selector:first-child{border-left:none}td.__jsx-style-dynamic-selector:nth-child(1){text-align:center;color:var(--moon-gray);padding:0 4px}.number.__jsx-style-dynamic-selector,.integer.__jsx-style-dynamic-selector,.bigint.__jsx-style-dynamic-selector{text-align:right}.number.__jsx-style-dynamic-selector,.integer.__jsx-style-dynamic-selector,.bigint.__jsx-style-dynamic-selector,.date.__jsx-style-dynamic-selector{font-variant-numeric:tabular-nums}".concat(p?"td:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":"","\n      ")})]})});var T=n(73507),columnSort=e=>{let{direction:t,...n}=e;return(0,r.jsxs)("svg",{width:"8",height:"12",viewBox:"0 0 8 12",fill:"none",...n,children:[(0,r.jsx)("path",{d:"M2.08062 5.5L5.91938 5.5C6.75788 5.5 7.22405 4.53007 6.70024 3.8753L4.78087 1.47609C4.38054 0.975679 3.61946 0.97568 3.21913 1.47609L1.29976 3.87531C0.775945 4.53007 1.24212 5.5 2.08062 5.5Z",fill:"asc"===t?"var(--dark-blue)":"desc"===t?"var(--faint-blue)":"var(--washed-blue)"}),(0,r.jsx)("path",{d:"M5.91938 6.5H2.08062C1.24212 6.5 0.775946 7.46993 1.29976 8.1247L3.21913 10.5239C3.61946 11.0243 4.38054 11.0243 4.78087 10.5239L6.70024 8.12469C7.22405 7.46993 6.75788 6.5 5.91938 6.5Z",fill:"desc"===t?"var(--dark-blue)":"asc"===t?"var(--faint-blue)":"var(--washed-blue)"})]})},V=n(84372),P=n(27554),F=n(47213),A=n(28857),U=n(69583),Z=n(61091);let ColumnNameInput=e=>{var t;let{dispatch:n,id:o,nodeData:l,name:i,schema:d}=e,[u,p]=(0,c.useState)(i),[m,v]=(0,c.useState)(),f=(0,c.useRef)(null),h=null===(t=l.operations.derive)||void 0===t?void 0:t.some(e=>e.name===i);function rename(e){var t,r;if(0===e.length){p(i);return}let a=null!==(t=l.operations.names)&&void 0!==t?t:[],s=new Map(a.map(e=>{let{column:t,name:n}=e;return[t,n]})),c=a.map(e=>{let{name:t}=e;return t}).concat(d?Array.from(d.keys()).filter(e=>!s.has(e)):[]),u=(0,Z.Q)(e,new Set(c)),m=null===l.operations.select.columns&&(null==d?void 0:d.size)?Array.from(d.keys()):l.operations.select.columns;if(h)n({id:o,type:"setDataOperations",operations:{select:{columns:m?m.map(e=>e===i?u:e):null},derive:null===(r=l.operations.derive)||void 0===r?void 0:r.map(e=>e.name===i?{...e,name:u}:e)}});else{let e=a.find(e=>{let{name:t}=e;return t===i}),t=e?e.column:i;n({id:o,type:"setDataOperations",operations:{select:{columns:m},names:[...a.filter(e=>{let{column:n}=e;return n!==t}),...t!==u?[{column:t,name:u}]:[]]}})}}return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{ref:f,type:"text",maxLength:256,value:u,placeholder:i,onKeyDown:e=>{if("Enter"===e.key){let t=e.target;t.value!==i&&rename(t.value),t.blur()}},onFocus:()=>v(!0),onBlur:e=>{e.target.value!==i&&rename(e.target.value),v(!1)},onChange:e=>p("".concat(e.target.value)),className:"jsx-bc569f74a99de77c "+(s()(m&&"w-100","dark-gray truncate b br1 ph0 mv1 bg-transparent")||"")}),m&&!h&&(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>{var e,t,r;let a=null===(e=l.operations.names)||void 0===e?void 0:e.find(e=>{let{name:t}=e;return t===i});p(null!==(t=null==a?void 0:a.column)&&void 0!==t?t:i),a&&n({id:o,type:"setDataOperations",operations:{names:null===(r=l.operations.names)||void 0===r?void 0:r.filter(e=>{let{name:t}=e;return t!==i})}})},className:"jsx-bc569f74a99de77c bn bg-transparent gray pointer",children:(0,r.jsx)(U.Z,{height:14,width:14})}),(0,r.jsx)(a(),{id:"bc569f74a99de77c",children:"input.jsx-bc569f74a99de77c{border:none}input.jsx-bc569f74a99de77c:hover,input.jsx-bc569f74a99de77c:focus{-webkit-box-shadow:0 0 0 1px var(--light-gray);-moz-box-shadow:0 0 0 1px var(--light-gray);box-shadow:0 0 0 1px var(--light-gray)}input.jsx-bc569f74a99de77c::-webkit-input-placeholder{color:var(--gray)}input.jsx-bc569f74a99de77c:-moz-placeholder{color:var(--gray)}input.jsx-bc569f74a99de77c::-moz-placeholder{color:var(--gray)}input.jsx-bc569f74a99de77c:-ms-input-placeholder{color:var(--gray)}input.jsx-bc569f74a99de77c::-ms-input-placeholder{color:var(--gray)}input.jsx-bc569f74a99de77c::placeholder{color:var(--gray)}"})]})};var B=n(94587),z=n(88398),q=n(18776),H=n(96815),W=n(8202),Y=n(23838);let SummaryText=e=>{let{color:t="var(--observable-mid-gray)",text:n="Some values",backgroundColor:o="#E2E2E2",borderColor:a="#E2E2E2",height:l=30,width:i=160}=e;return(0,r.jsx)("div",{className:"tc observable-mid-gray fw4 sans-serif",style:{height:l,width:i,padding:"5px",border:"1px solid ".concat(a),backgroundColor:o,color:t,marginTop:"4px",borderRadius:"5px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:n,children:n})};var G=n(19799),$=n(38887),J=n(36978),X=n(85235),K=n(96199),Q=n(66549),ee=n(22828),et=n(26599),en=n(84839),er=n(62841);let eo={empty:{background:"rgba(211, 152, 23, .4)",rect:"rgb(211, 152, 23)",text:"#8D640D",stroke:"none"},unique:{background:"#E2E2E2",rect:"#E2E2E2",text:"#6E6E6E",stroke:"#E2E2E2"},default:{background:"rgba(123,146,209, .4)",rect:"rgba(123,146,209)",text:"#2B50B0",stroke:"#97BBF4"}};function countFormat(e){let t=(0,G.WU)(",");return t(e)}function getHoverText(e,t){return"".concat(countFormat(e)," ").concat(1===e?"row":"rows","  (").concat(function(e){let t=(0,G.WU)(".2p");return"100%"===t(e)&&1!==e?">99%":t(e)}((e||t)/t),")")}let Histogram=e=>{var t,n,o,a,l,i;let{name:s,colSummary:d,colFilteredSummary:u,ready:p,formatter:m=String,hoveredValue:v,filters:f,setOperations:h,sendOperationsAnalyticsEvent:y,setChartLabel:g}=e,[b,x]=(0,c.useState)(-1),{numMissing:w,nRows:k,type:j,data:C}=d,{data:S,numMissing:M}=null!=u?u:{},pointerMove=e=>{var t;let n=e.nativeEvent.offsetX>T.range()[1]?w>0?-2:-1:D?0:(0,B.ml)(O,T.invert(e.nativeEvent.offsetX))-1;x(n);let r=-2===n?w:null===(t=C[n])||void 0===t?void 0:t.count;g(r?getHoverText(r,k):void 0)},R=(0,c.useRef)(null);function UnderBar(e){let{x:t}=e;return(0,r.jsx)("rect",{x:t,width:P,height:2,fill:"black",y:31,pointerEvents:"none"})}let N=0===C.length&&w>0,D=1===C.length&&C[0].x1===C[0].x2,E=N||D&&0===w,{x1:O,xMin:L,xMax:I,xScale:T,yScale:V,binWidth:P}=(0,c.useMemo)(()=>{var e,t;let n=C.map(e=>e.x1),r=0===w?130:130/(C.length+2)*C.length,o=null!==(e=(0,z.Z)(C,e=>e.x1))&&void 0!==e?e:0,a=null!==(t=(0,q.Z)(C,e=>e.x2))&&void 0!==t?t:1,l=(0,W.Z)().domain([o,a]).range([0,r]),i=C.length?D?r:l(C[0].x2)-l(C[0].x1)-1:0,s=(0,q.Z)([w||0,(0,q.Z)(C,e=>e.count)||0]),c=(0,W.Z)().domain([0,s]).range([30,0]);return{x1:n,xMin:o,xMax:a,xScale:l,yScale:c,binWidth:i}},[C,130,30,w,D]),F="symbol"!=typeof v,A=(0,_.getTypeValidator)(j),U=!A(v,j),Z=f&&f.filter(e=>e.operands[0].value===s&&"nv"===e.type).length>0,ea=-1===b?null:-2===b?{x1:T.invert(+T.range()[1]+P),x2:T.invert(130),count:w}:C[b],el=(l=b<0?L:null==ea?void 0:ea.x1,i=b<0?I:null==ea?void 0:ea.x2,"date"===j?e=>{var t,n;return(t=new Date(l||0),(n=new Date(i||0))>$.ol.offset(t)?(0,er.g0)("'%y"):n>J.me.offset(t)?(0,er.g0)("%b '%y"):n>X.pI.offset(t)?(0,er.g0)("%b %e"):n>K.AN.offset(t)?(0,er.g0)("%a %e"):n>Q.lM.offset(t)?(0,er.g0)("%I %p"):n>ee.rz.offset(t)?(0,er.g0)("%I:%M"):n>et.E.offset(t)?(0,er.g0)(":%S"):n>en.A.offset(t)?(0,er.g0)(".%L"):(0,er.g0)("%a %e"))(e)}:e=>(function(e,t,n){let r;switch(n){case"integer":case"bigint":if(r=(0,G.WU)("d"),t-e<=30)return e=>r(e-1e-12);break;case"number":r=(0,G.WU)("~f");break;default:throw Error("Unsupported number type: ".concat(n))}let o=Math.max(...[e,t].map(Math.abs));if(o<10||o>=1e4){let n=o<1?"~f":"~s";for(let o=2;o<8&&(r=(0,G.WU)(",.".concat(++o).concat(n)))(e)===r(t);++o);}return r})(l||0,i||0,j)(e));function drawRects(e,t,n){return(0,r.jsxs)("g",{children:[t>0&&(0,r.jsx)("rect",{x:+T.range()[1]+P,width:P,height:Math.max(1,V(0)-V(t)),y:Math.min(V(t),V(0)-1),fill:null!=n?n:eo.empty.rect,fillOpacity:F&&!U||b>-1?.4:1,stroke:Z?"black":"none"}),e.map((e,t)=>(0,r.jsx)("rect",{x:D?T.range()[0]:T(e.x1),width:P,height:0===e.count?0:(0,q.Z)([1,V(0)-V(e.count)]),y:0===e.count?V(0):Math.min(V(e.count),V(0)-1),fill:n||eo.default.rect,fillOpacity:F||t!==b&&-1!==b?.4:1},t))]})}let ei=w>0?T.range()[1]:130,es=(0,c.useMemo)(()=>(0,H.Yu)().extent([[0,0],[ei,31]]).on("brush end",e=>{var t;let n=f?f.filter(e=>e.operands[0].value!==s):[];if(void 0===e.sourceEvent)return;if(!e.selection){h(e=>n.length||e.filter?{...e,filter:n.length?n:void 0}:e),y({filter:n.length?n:void 0});return}let[r,o]=D?T.domain():e.selection.map(T.invert);n.push({type:"gte",operands:[{type:"column",value:"".concat(s)},{type:"date"===j?j:"primitive",value:r}]}),n.push({type:"lte",operands:[{type:"column",value:s},{type:"date"===j?j:"primitive",value:o}]}),n.push({type:"v",operands:[{type:"column",value:s},{type:"primitive",value:j}]}),h(e=>({...e,filter:n})),"end"===e.type&&(null===(t=e.sourceEvent)||void 0===t?void 0:t.type)==="mouseup"&&y({filter:n})}),[ei,f,30,s,h,T,j,D,y]),ec=p?()=>{let e;R.current&&(0,Y.Z)(R.current).call(es.clear);let t=[];for(let n of null!=f?f:[])n.operands[0].value!==s?t.push(n):"nv"===n.type&&(e=!0);e||t.push({type:"nv",operands:[{type:"column",value:s},{type:"primitive",value:j}]}),t=0===t.length?void 0:t,h(e=>({...e,filter:t})),y({filter:t})}:void 0;(0,c.useEffect)(()=>{var e,t;if(void 0===f)return;let n=f.filter(e=>e.operands[0].value===s),r=null===(e=n.find(e=>"gte"===e.type))||void 0===e?void 0:e.operands[1],o=null===(t=n.find(e=>"lte"===e.type))||void 0===t?void 0:t.operands[1];if(void 0===r||void 0===o||r.value===o.value||!R.current)return;let a=(0,Y.Z)(R.current);a.call(es),a.call(es.move,[T(r.value),T(o.value)])},[T,f,es,s]),(0,c.useEffect)(()=>{if(!p||!R.current)return;let e=(0,Y.Z)(R.current);e.call(es),f||e.call(es.move,null)},[f,es,s,p]);let ed=-2===b?"invalid ".concat(j):el(null!==(t=null==ea?void 0:ea.x1)&&void 0!==t?t:L),eu=-2===b?"":el(null!==(n=null==ea?void 0:ea.x2)&&void 0!==n?n:I);return eu===ed&&(eu=""),(0,r.jsxs)("div",{style:{marginBottom:"12px"},children:[E&&(0,r.jsx)(SummaryText,{backgroundColor:N?eo.empty.background:eo.default.background,color:N?eo.empty.text:eo.default.text,borderColor:N?eo.empty.text:eo.default.text,height:30,width:130,text:N?"all values: invalid ".concat(j):"all values: ".concat(m(C[0].x1||0))}),!E&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{style:{overflow:"visible"},height:30,width:130,children:[drawRects(C,w,f?"#d1d1d1":void 0),S&&drawRects(S,null!=M?M:0),(0,r.jsx)("line",{y1:31,y2:31,x1:T.range()[0],x2:T.range()[1],strokeWidth:.5,stroke:"#d3d3d3"}),(0,r.jsx)("rect",{onPointerEnter:pointerMove,onPointerMove:pointerMove,onPointerLeave:function(){x(-1),g(void 0)},width:132,x:-1,height:50,fillOpacity:.1,fill:"white"}),F&&(w>0&&U?(0,r.jsx)(UnderBar,{x:+T.range()[1]+P}):(0,r.jsx)("line",{x1:T(v),x2:T(v),y1:0,y2:30,strokeWidth:2,stroke:eo.default.rect})),-1!==b&&(0,r.jsx)(UnderBar,{x:-2===b?+T.range()[1]+P:D?T.range()[0]:T(null==ea?void 0:ea.x1)}),w>0&&-1===b&&(0,r.jsx)("text",{className:"fw4",x:+T.range()[1]+3*P/2,y:45,fill:eo.empty.rect,textAnchor:"middle",children:"⌀"}),w>0&&p&&(0,r.jsx)("rect",{fill:"none",stroke:(null==f?void 0:f.some(e=>e.operands[0].value===s&&"n"===e.type))?"#d2d2d2":"none",width:P,x:+T.range()[1]+P,onPointerDown:ec,height:30,style:{cursor:"pointer"}}),(0,r.jsx)("g",{ref:R})]}),(0,r.jsxs)("div",{className:"fw4 relative mid-gray",style:{pointerEvents:"none",zIndex:-1},children:[!(F&&U)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"absolute",style:{left:"".concat(-2===b?+T.range()[1]+ +P:T(null!==(o=null==ea?void 0:ea.x1)&&void 0!==o?o:L),"px"),transform:ea?"translate(-100%, 0)":"",color:-2===b?eo.empty.rect:"#555555"},children:ed}),(0,r.jsx)("div",{className:"absolute",style:{left:"".concat(T(null!==(a=null==ea?void 0:ea.x2)&&void 0!==a?a:I),"px"),transform:ea?"translate(0, 0)":"translate(-100%, 0)"},children:eu})]}),F&&(w>0&&U?(0,r.jsx)("div",{className:"bg-white absolute",style:{left:"".concat(+T.range()[1]+P,"px"),transform:"translate(-100%, 0)",color:eo.empty.rect},children:"invalid ".concat(j)}):(0,r.jsx)("div",{className:"bg-white absolute",style:{left:"".concat(T(v),"px"),paddingLeft:"4px",paddingRight:"4px",borderRadius:"5px",transform:"translate(-50%, 0)",color:"rgb(44, 85, 172)"},children:v?m(v):v}))]})]})]})};var ea=n(72255),el=n(40477),ei=n(98837);let es="<empty string>",StackedBar=e=>{let{colSummary:t,hoveredValue:n,name:o,ready:a,setOperations:l,filters:i,filteredData:d,sendOperationsAnalyticsEvent:u,setChartLabel:p}=e,m=(0,c.useMemo)(()=>null==i?void 0:i.filter(e=>e.operands[0].value===o),[i,o]),{type:v,data:f,isUnique:h,numCategories:y}=t,g=(0,c.useMemo)(()=>(null==m?void 0:m.map(e=>{let{type:t}=e;if("nv"===t)return"invalid ".concat(v);if("in"===t)return e.operands.filter(e=>"primitive"===e.type).map(e=>e.value);if("nin"===t){let t=e.operands.filter(e=>"primitive"===e.type).map(e=>e.value);return f.filter(e=>1!==e.categoryType&&!t.includes(e.label)).map(e=>e.label)}return[]}).flat())||[],[f,m,v]),b=null==m?void 0:m.map(e=>{let{type:t}=e;return t}),[x,w]=(0,c.useState)(-1),k=a?e=>{var t;let n=e.nativeEvent.offsetX<=5?1:e.nativeEvent.offsetX-5,r=C.invert(n),a=(0,B.Nw)(j,r)-1,s=M[a],c=[];if(1===s.categoryType){let e=null==b?void 0:b.includes("nv");e||c.push({type:"nv",operands:[{type:"column",value:o},{type:"primitive",value:v}]})}else if(2===s.categoryType){let e=null==b?void 0:b.includes("nin");if(!e){let e={type:"nin",operands:[{type:"column",value:o}]};for(let t of M)0===t.categoryType&&e.operands.push({type:"primitive",value:t.label});c.push({type:"v",operands:[{type:"column",value:o},{type:"primitive",value:v}]}),c.push(e)}}else{let t=s.label,n=(null==b?void 0:b.includes("in"))?g:[];if(e.getModifierState("Meta")){let e=n.indexOf(t);e>-1?n.splice(e,1):n.push(t)}else n=1===n.length&&n[0]===t?[]:[t];n.length>=1&&c.push({type:"in",operands:[{type:"column",value:o},...n.map(e=>({type:"primitive",value:e}))]})}let d=[...null!==(t=null==i?void 0:i.filter(e=>{let{operands:t}=e;return t[0].value!==o}))&&void 0!==t?t:[],...c];l(e=>({...e,filter:d.length?d:void 0})),u({filter:d.length?d:void 0})}:void 0;function getColor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rect";return 1===e?eo.empty[t]:2===e?eo.unique[t]:eo.default[t]}let{x1:j,xScale:C,total:S,allScaled:M,displayData:R,filteredScaled:N,smallCategories:_}=(0,c.useMemo)(()=>{let e=f.map(e=>e.x1),t=(0,W.Z)().domain([0,1]).range([0,130]),n=(0,ea.Z)(f,e=>e.count),r=f.map(e=>({width:t(e.x2-e.x1),...e})),o=-1,a=-1,l=r.filter((e,t)=>1===e.categoryType?(o=t,!1):2!==e.categoryType||(a=t,!1)),i=d&&d.length>0?new Map(d.map(e=>["".concat(e.label).concat(e.categoryType),e.count])):void 0,s=(0,el.Z)(ei.Z).right(l.map(e=>e.width),2),c=l.slice(0,s);s<l.length-1&&c.push(l.slice(s,l.length).reduce((e,t)=>({label:"small display",categoryType:3,x1:0,x2:0,count:e.count+t.count,width:e.width+t.width}))),a>=0&&c.push(r[a]),o>=0&&c.push(r[o]);let u=r.filter(e=>e.width<2);return{x1:e,xScale:t,total:n,allScaled:r,displayData:c,filteredScaled:i,smallCategories:u}},[f,d]);(0,c.useEffect)(()=>{var e,t;if(n===O.V8){w(-1),p(void 0);return}let r=typeof n!==v?null:n,o=null===r?M.find(e=>1===e.categoryType):null!==(e=M.find(e=>e.label===r))&&void 0!==e?e:M.find(e=>2===e.categoryType),a=null!==(t=null==o?void 0:o.x1)&&void 0!==t?t:0,l=(0,B.Nw)(j,a);w(l),p(l>=0&&l<M.length?getHoverText(M[l].count,S):void 0)},[n,j,M,v,p,S]);let D=-1===x?null:M[x];return(0,r.jsxs)("div",{className:"relative",style:{marginBottom:"16px"},children:[(h||1===y)&&(0,r.jsx)(SummaryText,{height:30,backgroundColor:2===f[0].categoryType?eo.unique.background:1===f[0].categoryType?eo.empty.background:eo.default.background,color:2===f[0].categoryType?eo.unique.text:1===f[0].categoryType?eo.empty.text:eo.default.text,borderColor:2===f[0].categoryType?eo.unique.text:1===f[0].categoryType?eo.empty.text:eo.default.text,text:2===f[0].categoryType?f[0].label:1===f[0].categoryType?"all values: invalid ".concat(v):'all values: "'.concat(f[0].label,'"'),width:130}),!h&&y>1&&(0,r.jsxs)("div",{style:{position:"relative"},children:[(0,r.jsxs)("div",{style:{width:130,height:30,marginBottom:"3px",display:"flex",borderRadius:"5px",overflow:"hidden"},children:[R.map((e,t)=>{let n=!!(2===e.categoryType&&(null==b?void 0:b.includes("nin")))||!!(1===e.categoryType&&(null==b?void 0:b.includes("nv")))||g.includes(e.label),o=i?((null==N?void 0:N.get("".concat(e.label).concat(e.categoryType)))||0)/e.count*100:100,a=2===e.categoryType?"unique":"".concat(""===e.label?es:e.label);return(0,r.jsx)("div",{title:a,className:"flex items-center fw4 sans-serif",style:{background:3===e.categoryType?"repeating-linear-gradient(\n                      to right,\n                      ".concat(i?"#d1d1d1":eo.default.rect," 0px,\n                      ").concat(i?"#d1d1d1":eo.default.rect," 1px,\n                      ").concat(i?"white":eo.default.stroke," 1px,\n                      ").concat(i?"white":eo.default.stroke," 2px\n                    )"):i?"linear-gradient(to top, ".concat(getColor(e.categoryType,"rect")," ").concat(o,"%, #d1d1d1 ").concat(o,"%, #d1d1d1 ").concat(100-o,"%)"):getColor(e.categoryType,"rect"),width:e.width,height:30,borderColor:n?"black":i?"white":getColor(e.categoryType,"stroke"),borderWidth:n?"1px":t===R.length-1?"0px":"0px 1px 0px 0px",borderStyle:"solid",opacity:-1===x?1:(null==D?void 0:D.label)===e.label&&D.categoryType===e.categoryType&&D.width>=1?1:.4,textAlign:"center",borderRadius:0===t?"5px 0px 0px 5px":t===R.length-1?"0px 5px 5px 0px":"0px",position:"relative",boxSizing:"border-box"},children:e.count/S>.1&&"small display"!==e.label&&(0,r.jsx)("span",{style:{overflow:"hidden",width:"calc(100% - 4px + ".concat(n?"1px":"0px",")"),left:n?"-1px":"0px",position:"absolute",padding:"0px 2px",color:2===e.categoryType?eo.unique.text:"white"},children:a})},"".concat(e.label,"_").concat(e.categoryType))}),m&&_.length>0&&g.map(e=>{var t;let n=null===(t=_.find(t=>t.label===e))||void 0===t?void 0:t.x1;return void 0===n?null:(0,r.jsx)("div",{style:{width:130*n,height:30,position:"absolute",borderRight:"1px solid ".concat(eo.default.rect)}},"highlight-mark".concat(e))}),D&&D.width<2&&(0,r.jsx)("div",{style:{width:130*D.x1,height:30,position:"absolute",borderRight:"1px solid ".concat(eo.default.rect)}})]}),(0,r.jsx)("div",{onPointerMove:e=>{let t=e.nativeEvent.offsetX<5?1:e.nativeEvent.offsetX-5,n=C.invert(t),r=(0,B.Nw)(j,n)-1;w(r),p(r>=0&&r<M.length?getHoverText(M[r].count,S):void 0)},onPointerLeave:function(){p(void 0),w(-1)},onPointerDown:k,className:s()("absolute",a?"pointer":""),style:{top:"0px",left:"-".concat(5,"px"),width:"".concat(140,"px"),height:50,backgroundColor:"rgba(255,255,255, .01)"}}),(0,r.jsx)("div",{className:"mid-gray fw4 absolute",style:{pointerEvents:"none",height:"15px",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis"},children:D?"".concat(""===D.label?es:D.label):g.length>0?g.map(e=>""===e?es:e).join(", "):"".concat(countFormat(y)," ").concat(y>1?"categories":"category")})]})]})};var ec=n(27522),ed=n(66338),eu=n(10998),ep=n(17);let ColumnTypeSelector=e=>{let{value:t,inferredType:n,node:o,name:a,disabled:i}=e,s=(0,ed.I0)(),c=["raw","other","array","object","buffer","integer"];return(0,r.jsxs)(ec.vz,{onChange:e=>{var t,r,l;let i=(null===(r=o.data.operations.names)||void 0===r?void 0:null===(t=r.find(e=>{let{name:t}=e;return a===t}))||void 0===t?void 0:t.column)||a,c=o.data.operations.filter.filter(e=>{let t=e.operands[0].value;return t!==i});s({type:"setDataOperations",id:o.id,operations:{types:[...(null!==(l=o.data.operations.types)&&void 0!==l?l:[]).filter(e=>e.name!==i),{name:a,type:"auto"===e?n:e}],filter:c}})},value:t===n?"auto":t,className:"pointer",style:{flexShrink:"0"},disabled:i,children:[(0,r.jsxs)(ec.Y4,{className:"flex items-center fw4 mid-gray outline-0 mb2",children:[(0,r.jsx)("div",{style:{maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis"},children:t}),(0,r.jsx)(ec.r9,{className:"inline-flex items-center gray ml1",children:(0,r.jsx)(eu.Z,{})})]}),(0,r.jsxs)(ec.jI,{className:"shadow-4 bg-white ba b--silver br2 mt1 pb1 pt1",style:{width:"160px"},children:[(0,r.jsx)("div",{className:"gray f7 ph2 pt1 pb1",children:"Column type"}),(0,r.jsx)("div",{className:"bb b--silver mt1 mb1"}),(0,r.jsxs)(ec.uf,{className:"outline-0",style:{padding:0,margin:0},children:[(0,r.jsx)(ColumnOption,{value:"auto",selected:n===t,sideLabel:n},"auto"),(0,r.jsx)(ColumnOption,{value:"raw",selected:"raw"===t},"raw"),(0,r.jsx)("div",{className:"bb b--silver mt1 mb1"}),Array.from(l.IG).filter(e=>!c.includes(e)).map(e=>(0,r.jsx)(ColumnOption,{value:e,selected:e===t&&n!==t},e))]})]})]})},ColumnOption=e=>{let{value:t,selected:n,sideLabel:o}=e;return(0,r.jsxs)(ec.wt,{value:t,className:"flex pl2 pr3 pv1 f6 fw5 dark-gray pointer",style:{gap:"8px"},children:[n?(0,r.jsx)(ep.Z,{style:{flex:"0 0 16px"}}):(0,r.jsx)("div",{style:{flex:"0 0 16px"}}),(0,r.jsxs)("div",{className:s()("flex selected",o&&"items-center justify-between w-100 truncate"),children:[(0,r.jsx)("span",{className:"truncate",children:t}),o&&(0,r.jsx)("span",{className:"gray fw4",children:o})]})]},t)};var em=n(20736);let ev={summaryType:"empty",data:[],maxLength:0,type:"string",inferred:"string"},TableHeadCell=e=>{var t,n,o,l;let{name:i,canShowSummaries:s,setDraggingColumn:d,width:u,node:p,schema:m,setColumnsFlash:v,colSummary:f,colFilteredSummary:h,operations:y,hoveredValue:g,setOperations:b,isUntypedDialect:x,ready:w,embed:k,editingColumn:j,editingColumnName:C,finishEditingColumn:S,startEditingColumn:M,allowDerivedColumns:R}=e,{id:N,mode:_}=p,D=(0,L.I0)(),{pending:E}=(0,L.v9)(e=>{var t;let{notebook:n}=e;return{pending:(null===(t=n.workerStatus.get(N))||void 0===t?void 0:t.status)==="pending"}}),I=null===(t=y.sort)||void 0===t?void 0:t.find(e=>{let{column:t}=e;return t===i}),T=(0,O.t2)(i,y),P=j===i,F="table"===_&&R&&(P||!!(null===(n=p.data.operations.derive)||void 0===n?void 0:n.some(e=>e.name===i))),A=(0,em.GS)(em.Hb),[U,Z]=(0,c.useState)(!1),[B,z]=(0,c.useState)(),q=(0,c.useCallback)(e=>{let{filter:t,sort:n}=e;D({type:"setLocalOperations",id:N,operations:{filter:t,sort:n}})},[D,N]);return(0,c.useEffect)(()=>z(void 0),[f.type]),(0,r.jsxs)("th",{onMouseUp:()=>d(void 0),style:{width:u,padding:5,height:s?70:void 0,background:P?"var(--observable-focus-lightest-blue)":I||T?"var(--washed-yellow)":""},className:"jsx-86b862ef0ed2c097 fw4 mid-gray",children:[(0,r.jsxs)("div",{style:{height:25},className:"jsx-86b862ef0ed2c097 flex justify-between items-center",children:["table"!==_||P?(0,r.jsx)("div",{title:C||i,className:"jsx-86b862ef0ed2c097 dark-gray truncate b",children:C||i}):(0,r.jsx)(ColumnNameInput,{dispatch:D,id:N,nodeData:p.data,name:i,schema:m}),!P&&(0,r.jsxs)("div",{style:{visibility:!A||U||void 0!==I?"visible":void 0},className:"jsx-86b862ef0ed2c097 pl1 flex items-center column-menu",children:[(0,r.jsx)("button",{onClick:e=>{var t;return t=e.shiftKey,void b(e=>{var n;let r=null===(n=e.sort)||void 0===n?void 0:n.find(e=>{let{column:t}=e;return t===i}),o=void 0===r?{column:i,direction:t?"desc":"asc"}:"asc"===r.direction?{column:i,direction:"desc"}:void 0;return q({sort:o?[o]:void 0}),{...e,sort:o?[o]:void 0}})},title:"Sort column",className:"jsx-86b862ef0ed2c097 pointer bn pl1 pr0 pv1 bg-transparent",children:(0,r.jsx)(columnSort,{direction:(null==I?void 0:I.column)===i?I.direction:void 0})}),!k&&(0,r.jsx)(TableHeadMenu,{node:p,setFocus:Z,hide:function(){let e=Array.from((null==m?void 0:m.keys())||[]);if(!E&&"table"===_){var t,n,r;let o=null===(t=p.data.operations.names)||void 0===t?void 0:t.find(e=>{let{name:t}=e;return t===i}),a=null!==(n=null==o?void 0:o.column)&&void 0!==n?n:i;D({type:"setDataOperations",id:N,operations:{select:{columns:(null!==(r=p.data.operations.select.columns)&&void 0!==r?r:e).filter(e=>e!==a)}},source:"table"}),null==v||v(!0)}},currentSort:null===(l=y.sort)||void 0===l?void 0:null===(o=l.find(e=>{let{column:t}=e;return t===i}))||void 0===o?void 0:o.direction,onSort:function(e){b(t=>{let n=e?[{column:i,direction:e}]:void 0;return q({sort:n}),{...t,sort:n}})},name:i,isBeingEdited:P,startEditingColumn:M,finishEditingColumn:S,allowDeriveActions:F,allowDerivedColumns:R})]})]}),(0,r.jsxs)("div",{className:"jsx-86b862ef0ed2c097 mb2 h1 flex justify-between",children:[B||(x&&"table"===_?(0,r.jsx)(ColumnTypeSelector,{value:f.type,inferredType:f.inferred,node:p,name:i,disabled:P}):f.type),F&&(0,r.jsx)(V.Z,{className:"hover-mid-gray moon-gray pointer",onClick:()=>{P?S():M(i)}})]}),s&&("categorical"===f.summaryType?(0,r.jsx)(StackedBar,{name:i,colSummary:f,ready:w,filteredData:null==h?void 0:h.data,hoveredValue:g,setOperations:b,filters:y.filter,sendOperationsAnalyticsEvent:q,setChartLabel:z}):"continuous"===f.summaryType?(0,r.jsx)(Histogram,{colSummary:f,ready:w,colFilteredSummary:h,formatter:(0,O.QI)(f.type),hoveredValue:g instanceof Date||"symbol"==typeof g||null==g?g:Number(g),name:i,filters:y.filter,setOperations:b,sendOperationsAnalyticsEvent:q,setChartLabel:z}):null),(0,r.jsx)("button",{onMouseDown:()=>d(i),className:"jsx-86b862ef0ed2c097 resize-handle"}),(0,r.jsx)(a(),{id:"86b862ef0ed2c097",children:"th.jsx-86b862ef0ed2c097{position:relative;background:var(--white);border-bottom:solid 1px var(--light-silver);border-left:solid 1px var(--light-silver);z-index:1}th.jsx-86b862ef0ed2c097 .column-menu.jsx-86b862ef0ed2c097{visibility:hidden}th.jsx-86b862ef0ed2c097:hover .column-menu.jsx-86b862ef0ed2c097{visibility:visible}th.jsx-86b862ef0ed2c097:first-child{border-left:none;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:30px;padding:7px}th: hover {z-index:9999}.resize-handle.jsx-86b862ef0ed2c097{background-color:var(--transparent);border:none;display:block;padding:0px;position:absolute;cursor:col-resize;width:3px;right:0;top:0;z-index:1;height:100px}.resize-handle.jsx-86b862ef0ed2c097:hover{background-color:var(--light-silver)}"})]},i)},TableHeadMenu=e=>{var t;let{node:n,onSort:o,hide:a,currentSort:l,setFocus:i,name:s,isBeingEdited:c,startEditingColumn:u,finishEditingColumn:p,allowDeriveActions:v,allowDerivedColumns:f}=e,{id:h,mode:y,data:g}=n,x="operations"in g&&(null===(t=g.operations.derive)||void 0===t?void 0:t.some(e=>{let{name:t}=e;return t===s})),w=[void 0,"asc","desc"],k=(0,L.I0)(),j="flex w-100 pv1 ph2 bg-transparent bn hover-bg-light-silver items-center pointer hover-b--silver fw6 tl";return(0,r.jsx)(b.v2,{children:e=>{let{isExpanded:t}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.j2,{title:"Column actions","aria-label":"Column actions",onClick:()=>i(t),className:"bn pa0 bg-transparent washed-blue pointer",children:(0,r.jsx)(F.Z,{})}),(0,r.jsx)(b.YI,{style:{width:"200px"},"data-cy":"table-head-menu-popover",className:"bg-white ba b--silver br2 shadow-4 outline-0",children:(0,r.jsxs)(b.sd,{className:"dark-gray fw6 pv1",children:["table"===y&&f&&(0,r.jsxs)(r.Fragment,{children:[x?(0,r.jsxs)(b.sN,{title:"Toggle editing","aria-label":"Toggle editing",className:j,onSelect:()=>{c?p():u(s)},children:[c?(0,r.jsx)(d.Z,{className:"pr2"}):(0,r.jsx)(V.Z,{className:"pr2"}),(0,r.jsx)("div",{children:c?"Finish editing":"Edit expression"})]}):(0,r.jsxs)(b.sN,{title:"Derive column","aria-label":"Derive column",className:j,onSelect:()=>{u(void 0,s)},children:[(0,r.jsx)(m.ZP,{className:"mr2"}),"Derive column"]}),(0,r.jsx)("div",{className:"mv1 bt b--silver"})]}),w.map(e=>{let t=e?"Sort ".concat(e,"ending"):"No sorting";return(0,r.jsxs)(b.sN,{title:t,className:j,onSelect:()=>o(e),children:[(0,r.jsx)(T.E,{className:"flex",checked:e?l===e:!l,readOnly:!0}),(0,r.jsx)(columnSort,{direction:e,className:"mr2"}),(0,r.jsx)("div",{children:t})]},null!=e?e:"undefined")}),"table"===y&&!c&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mv1 bt b--silver"}),(0,r.jsxs)(b.sN,{title:"Hide column","aria-label":"Hide column",onSelect:a,children:[(0,r.jsx)(A.Z,{className:"pr2"}),(0,r.jsx)("div",{children:"Hide"})]}),v&&(0,r.jsxs)(b.sN,{title:"Delete column","aria-label":"Delete column",onSelect:()=>{var e,t;let n=g.operations.select.columns;k({type:"setDataOperations",id:h,operations:{select:{columns:n?n.filter(e=>e!==s):null},derive:[...null!==(t=null===(e=g.operations.derive)||void 0===e?void 0:e.filter(e=>e.name!==s))&&void 0!==t?t:[]]}})},children:[(0,r.jsx)(P.Z,{className:"pr2"}),(0,r.jsx)("div",{children:"Delete"})]})]})]})})]})}})};var ef=n(55288),eh=n(71256);let TableHead=e=>{var t,n;let{node:o,summary:i,filteredSummary:s,hoveredRow:d,operations:u,setOperations:p,colWidths:m,setColWidths:v,setColumnsFlash:f,embed:h,tableRef:y,editingColumn:g,editingColumnName:b,finishEditingColumn:x,startEditingColumn:w,sourceInfo:k,allowDerivedColumns:j}=e,{id:C,data:S}=o,M=(0,L.I0)(),R=(0,c.useRef)(0),N=(0,c.useRef)(null),_=(0,eh.pN)(S,M,o.mode,!0,C),[D,E]=(0,c.useState)(),I=(null===(t=S.display)||void 0===t?void 0:t.mode)!=="table"||null===(n=S.display.showSummaries)||void 0===n||n,T=!!I&&null!=i&&!!i.nRows&&i.nRows>1;function scroll(){var e;N.current=requestAnimationFrame(scroll),null===(e=y.current)||void 0===e||e.scrollBy(R.current,0),v(e=>{if(!D)return e;let t=new Map(e),n=e.get(D);return t.set(D,Math.max(150,(null!=n?n:0)+R.current)),t})}let V=(0,c.useCallback)(()=>{E(void 0),N.current&&(cancelAnimationFrame(N.current),N.current=null)},[]);return(0,c.useEffect)(()=>(window.addEventListener("mouseup",V),()=>window.removeEventListener("mouseup",V)),[V]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("thead",{onPointerMove:e=>{D&&(v(t=>{let n=new Map(t),r=t.get(D);return n.set(D,Math.max(150,(null!=r?r:0)+e.movementX)),n}),function(e){var t;let n=null===(t=y.current)||void 0===t?void 0:t.getBoundingClientRect();R.current=n&&e-n.right+30>0?5:0,R.current&&!N.current?N.current=requestAnimationFrame(scroll):N.current&&!R.current&&(cancelAnimationFrame(N.current),N.current=null)}(e.clientX))},className:a().dynamic([["381d3ebf4f57e123",[j?"th:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]])+" sticky top-0 v-top tl",children:(0,r.jsxs)("tr",{className:a().dynamic([["381d3ebf4f57e123",[j?"th:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]]),children:[(0,r.jsx)("th",{role:"button","data-cy":"cell-table-header-row",onClick:()=>{M({type:"setDisplay",id:C,display:{mode:"table",showSummaries:!I}})},className:a().dynamic([["381d3ebf4f57e123",[j?"th:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]]),children:(0,r.jsx)(ef.Z,{style:{transform:I?"":"rotate(-90deg)",transition:"transform 150ms ease"}})}),i&&Array.from(i.columns,e=>{let[t,n]=e,a=d?d[t]:O.V8,c=(null==m?void 0:m.get(t))||150;return(0,r.jsx)(TableHeadCell,{name:t,hoveredValue:a,width:c,canShowSummaries:T,colSummary:n,colFilteredSummary:null==s?void 0:s.columns.get(t),operations:u,setOperations:p,node:o,setDraggingColumn:E,ready:i.ready,setColumnsFlash:f,isUntypedDialect:(0,l.$S)(null==k?void 0:k.dialect),schema:_,embed:h,editingColumn:g,editingColumnName:b,finishEditingColumn:x,startEditingColumn:w,allowDerivedColumns:j},t)}),(0,r.jsx)("th",{style:{width:"99%",...j?{borderLeft:"none",borderRight:"none"}:null},className:a().dynamic([["381d3ebf4f57e123",[j?"th:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]])}),"table"===o.mode&&j&&(0,r.jsx)("th",{style:{width:"40px",borderLeft:"none"},className:a().dynamic([["381d3ebf4f57e123",[j?"th:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""]]])})]})}),(0,r.jsx)(a(),{id:"381d3ebf4f57e123",dynamic:[j?"th:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":""],children:"th{position:relative;background:var(--white);border-bottom:solid 1px var(--light-silver);border-left:solid 1px var(--light-silver)}th:first-child{border-left:none;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:30px;padding:7px}.resize-handle{background-color:var(--transparent);border:none;display:block;padding:0px;position:absolute;cursor:col-resize;width:3px;right:0;top:0;z-index:1;height:100px}.resize-handle:hover{background-color:var(--light-silver)}".concat(j?"th:nth-last-child(3) {\n              border-right: 1px solid var(--light-silver);\n            }":"","\n      ")})]})};var ey=n(6359),eg=n(4640),eb=n(94549),ex=n(90271),ew=n(41312);let SummaryDisplayTask=class SummaryDisplayTask extends eg.i{async process(e){return await e({type:"request_table_summary",node_id:this._id,filters:this._filters})}constructor(e,t){super(),this._id=e,this._filters=t}};let RowsDisplayTask=class RowsDisplayTask extends eg.i{async process(e){let t=await e({type:"request_table_rows",node_id:this._id,operations:this._operations,start:this._start,end:this._end,search:this._search});return{rows:t.rows,searchInfo:t.searchInfo,error:t.error}}constructor(e,t,n,r,o){super(),this._id=e,this._start=t,this._end=n,this._operations=r,this._search=o}};let ek="var(--border-radius-2)",ej=c.memo(function(e){var t,n,o,i;let{node:f,operations:h,setOperations:y,setColumnsFlash:g,embed:b,editorOpen:x}=e,{id:w,pinned:k}=f,j=(0,L.I0)(),C=(0,c.useDeferredValue)(h),[S,M]=(0,c.useState)(),[R,N]=(0,c.useState)(),[_,D]=(0,c.useState)(),[E,O]=(0,c.useState)(20),[T,V]=(0,c.useState)(),[P,F]=(0,c.useState)(new Map),[A,U,B]=(0,eb.G)(""),[z,q]=(0,c.useState)(null),[H,W]=(0,c.useState)(),[Y,G]=(0,c.useState)(""),[$,J]=(0,c.useState)(),[X,K]=(0,c.useState)(),{generation:Q,leftRadius:ee,bottomRadius:et,allowDerivedColumns:en,pending:er}=(0,L.v9)(e=>{var t,n,r,o;let{notebook:{hoverId:a,focusId:i,workerStatus:s}}=e;return{generation:null!==(o=null===(n=s.get(w))||void 0===n?void 0:null===(t=n.display)||void 0===t?void 0:t.generation)&&void 0!==o?o:-1,leftRadius:a===w||i===w?void 0:ek,bottomRadius:i===w||k?void 0:ek,allowDerivedColumns:(0,l.$S)(null==z?void 0:z.dialect),pending:(null===(r=s.get(w))||void 0===r?void 0:r.status)==="pending"}}),eo=(0,eh.pN)(f.data,j,"table",!0,w),ea=(0,c.useRef)(null),el=(0,c.useRef)(null),ei=(0,c.useRef)(null),es=(0,c.useRef)(),ec=(0,c.useRef)(),ed=(0,c.useRef)(),eu=(0,c.useRef)(),ep=(null==S?void 0:S.generation)===Q&&S.operations===C&&S.debouncedSearch===B?S.rows.length:0;(0,c.useEffect)(()=>{void 0!==H&&(G(H),N(e=>{if(void 0===e||e.columns.has(H))return e;let t=new Map(e.columns);return t.set(H,ev),{...e,columns:t}}))},[H]),(0,c.useEffect)(()=>{var e,t;void 0!==H&&(null==R?void 0:null===(e=R.columns.get(H))||void 0===e?void 0:e.summaryType)==="empty"&&(null===(t=ea.current)||void 0===t||t.scrollTo({left:ea.current.scrollWidth}))},[H,R]),(0,c.useEffect)(()=>{if(null===f.data.source.name)eu.current=void 0,q(null);else{let e=new ey.FJ(f.data.source);eu.current=e,e.run(j).then(t=>{e===eu.current&&q(t)},()=>{e===eu.current&&q(null)})}},[j,f.data.source]),(0,c.useEffect)(()=>{let e=new SummaryDisplayTask(w);es.current=e,e.run(j).then(t=>{e===es.current&&N(t)},t=>{e===es.current&&console.error("table data failed: ".concat(t))})},[w,j,Q]),(0,c.useEffect)(()=>{if(!C.filter){D(void 0);return}let e=new SummaryDisplayTask(w,C.filter);ec.current=e,e.run(j).then(t=>{e===ec.current&&D(t)},t=>{e===ec.current&&console.error("table data failed: ".concat(t))})},[w,j,Q,C.filter]),(0,c.useEffect)(()=>{if((null==S?void 0:S.error)!==void 0&&0===S.rows.length&&void 0!==eo){let e=new Map(Array.from(eo).map(e=>{let[t]=e;return[t,ev]}));N({columns:e,nRows:0,ready:!0})}},[eo,null==S?void 0:S.error,null==S?void 0:S.rows.length]),(0,c.useEffect)(()=>{if(ep>=E)return;let e=new RowsDisplayTask(w,ep,E,C,B);ed.current=e,e.run(j).then(t=>{e===ed.current&&(M(e=>{let n=(null==e?void 0:e.generation)!==Q||e.operations!==C||e.debouncedSearch!==B;return{rows:n?t.rows:e.rows.concat(t.rows),searchInfo:t.searchInfo,generation:Q,operations:C,debouncedSearch:B,error:t.error}}),t.error&&j({id:w,type:"tableDisplayError"}))},t=>{e===ed.current&&console.error("table data failed: ".concat(t))})},[w,j,C,Q,ep,E,B]),(0,c.useEffect)(()=>{y(e=>{var t;if(void 0===R||void 0===e.filter&&void 0===e.sort)return e;let n=[];if(e.filter){let t=e.filter.reduce((e,t)=>{let n=t.operands[0].value;return e.has(n)?e.get(n).push(t):e.set(n,[t]),e},new Map);for(let[e,r]of t.entries()){let t=function(e,t){if(void 0===t)return[];let n=[];if("continuous"===t.summaryType){var r,o,a;let l=e.find(e=>{let{type:t}=e;return"nv"===t});if(void 0!==l)return t.numMissing>0?e:[];let i=e.find(e=>{let{type:t}=e;return"gte"===t}),s=e.find(e=>{let{type:t}=e;return"lte"===t});if(void 0===s||void 0===i||(r=i.operands[1].value,o=s.operands[1].value,a=t.min,!(r<t.max)||!(a<o)))return[];for(let r of e){let e=r.operands[0];if("in"!==r.type&&"nin"!==r.type){if("lte"===r.type){let o=r.operands[1].value;if("number"==typeof o&&o>t.max){let o={type:r.type,operands:[e,{type:"primitive",value:t.max}]};n.push(o);continue}}if("gte"===r.type){let o=r.operands[1].value;if("number"==typeof o&&o<t.min){let o={type:r.type,operands:[e,{type:"primitive",value:t.min}]};n.push(o);continue}}n.push(r)}}}else{let r=new Set(t.data.map(e=>e.label));for(let t of e){let e=t.operands[0];if("lt"!==t.type&&"gt"!==t.type&&("in"===t.type||"nin"===t.type)){let o=t.operands.filter(e=>{let{type:t,value:n}=e;return"primitive"===t&&r.has(n)});o.length>0&&n.push({type:t.type,operands:[e,...o]})}}}return n}(r,R.columns.get(e));n=[...n,...t]}}let r=Array.from(R.columns.keys()),o=null===(t=e.sort)||void 0===t?void 0:t.filter(e=>r.includes(e.column));return{filter:n.length?n:void 0,sort:(null==o?void 0:o.length)?o:void 0}})},[R,y]),(0,c.useEffect)(()=>{var e;null===(e=ea.current)||void 0===e||e.scrollTo({top:0}),O(20)},[f,C,B]),(0,c.useEffect)(()=>{(null==R?void 0:R.columns)&&F(new Map(Array.from(R.columns.entries(),e=>{var t;let[n,r]=e,o=null!==(t=r.maxLength)&&void 0!==t?t:0;return[n,7*o<150?150:7*o<250?250:350]})))},[R]),(0,c.useEffect)(()=>{B&&j({id:w,type:"tableSearch"})},[j,w,B]);let em=(0,c.useCallback)((e,t)=>{if("sql"===f.mode||!e||!t)return;let n=e;e!==H&&(n=(0,Z.Q)(e,new Set(null==R?void 0:R.columns.keys())));let r=f.data.operations.derive?[...f.data.operations.derive]:[],o=r.findIndex(e=>e.name===H);o>-1?r[o]={name:n,value:t}:r=[...r,{name:n,value:t}];let a=f.data.operations.select.columns;if(null!==a){let e=a.findIndex(e=>e===H);e>-1?(a=[...a])[e]=n:a=[...a,n]}j({type:"setDataOperations",id:f.id,operations:{derive:r,select:{columns:a}}}),W(n)},[j,H,f.id,f.mode,f.data,null==R?void 0:R.columns]),ef=(0,c.useCallback)(()=>{var e;$?em(Y,$):!H||(null===(e=f.data.operations.derive)||void 0===e?void 0:e.find(e=>{let{name:t}=e;return t===H}))||N(e=>{if(void 0===e)return e;let t=new Map(e.columns);return t.delete(H),{...e,columns:t}}),W(void 0),G(""),J(void 0)},[H,Y,$,f.data,em]),eg=(0,c.useCallback)((e,t)=>{var n,r;if("sql"===f.mode)return;void 0!==H&&ef();let o=null!=e?e:(0,Z.Q)(null!=t?t:"newColumn",new Set(null==R?void 0:R.columns.keys()));W(o);let a=null===(r=f.data.operations.derive)||void 0===r?void 0:null===(n=r.find(t=>t.name===e))||void 0===n?void 0:n.value;a?J(a):void 0!==t&&J('row["'.concat(t,'"]'))},[H,ef,f.data,f.mode,null==R?void 0:R.columns]);return(0,c.useEffect)(()=>{let e=new ResizeObserver(e=>{var t;let n=null===(t=e[0])||void 0===t?void 0:t.target;n&&K(n.offsetWidth-n.clientWidth)}),t=ea.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[]),(0,r.jsxs)("div",{className:"jsx-fec60529c9a8369d relative pea",children:[(0,r.jsxs)("div",{ref:ea,onScroll:e=>{let{currentTarget:t}=e;t.scrollHeight-t.scrollTop<492&&ep>=E&&O(E+20)},style:{margin:"0 -14px",borderTopLeftRadius:ee,borderTopRightRadius:ek,borderWidth:1},className:"jsx-fec60529c9a8369d "+(s()("container bt bl br b--light-silver",(null==S?void 0:S.error)===void 0?"overflow-auto":"overflow-x-auto")||""),children:["table"===f.mode&&en&&(0,r.jsx)("div",{style:{top:"6px",right:(null!=X?X:0)>2?"1px":"-12px"},className:"jsx-fec60529c9a8369d absolute z-1",children:H?(0,r.jsx)("button",{onClick:ef,title:"Finish editing column",className:"jsx-fec60529c9a8369d bg-transparent bn p0",children:(0,r.jsx)(d.Z,{className:"bg-white b--silver ba pointer br2 shadow-2 outline-0 mid-gray hover-near-black pa1"})}):(0,r.jsx)("button",{title:"Insert new column",onClick:()=>eg(void 0),className:"jsx-fec60529c9a8369d bg-transparent bn p0",children:(0,r.jsx)(m.ZP,{className:"bg-white b--silver ba pointer br2 shadow-2 outline-0 mid-gray hover-near-black pa1"})})}),(0,r.jsxs)("table",{style:{tableLayout:"fixed"},ref:el,className:"jsx-fec60529c9a8369d w-100 dark-gray ma0 nowrap overflow-visible",children:[R&&(0,r.jsx)(TableHead,{node:f,summary:R,filteredSummary:_,hoveredRow:T?null==S?void 0:S.rows[T.row]:void 0,operations:C,setOperations:y,colWidths:P,setColWidths:F,setColumnsFlash:g,embed:b,tableRef:ea,editingColumn:H,editingColumnName:Y,startEditingColumn:eg,finishEditingColumn:ef,sourceInfo:z,allowDerivedColumns:en}),S&&(void 0===S.error||S.rows.length>0)&&(0,r.jsx)(I,{data:S,node:f,summary:R,hoveredCell:T,setHoveredCell:V,colWidths:P,searchInfo:S.searchInfo,editingColumn:H,allowDerivedColumns:en})]})]}),(null==S?void 0:S.error)&&(0,r.jsx)("div",{style:{margin:"0 -14px"},className:"jsx-fec60529c9a8369d "+(s()("code observable-red fw5 f6 pa2 b--light-silver ba",0===S.rows.length&&"bt-0")||""),children:S.error}),"table"===f.mode&&H?(0,r.jsxs)("div",{style:{margin:"0 -14px"},className:"jsx-fec60529c9a8369d flex items-center pa2 ba b--light-silver",children:[(0,r.jsx)("div",{style:{width:150},className:"jsx-fec60529c9a8369d mr2",children:(0,r.jsx)("input",{title:"Edit derived column name",style:{boxShadow:"0 0 0 1px var(--light-gray)"},value:Y,placeholder:"newColumn",onChange:e=>{G(e.target.value)},className:"jsx-fec60529c9a8369d dark-gray truncate b bn br1 pv1 bg-transparent w-100"})}),(0,r.jsxs)("div",{className:"jsx-fec60529c9a8369d flex w-100 overflow-hidden",children:[(0,r.jsx)("div",{className:"jsx-fec60529c9a8369d w-100 overflow-hidden bg-near-white br2 br--left",children:(0,r.jsx)(FormulaEditor,{editingColumnName:Y,formula:$,setFormula:J,saveDeriveColumn:em},H)}),(0,r.jsx)(CodeExampleMenu,{}),(0,r.jsx)("button",{style:{width:29,height:29},onClick:()=>{em(Y,$)},className:"jsx-fec60529c9a8369d bn br2 br--right items-center align-center justify-center flex pointer bg-near-white",children:(0,r.jsx)(p.Z,{className:""})}),(0,r.jsx)("button",{style:{height:29},onClick:ef,className:"jsx-fec60529c9a8369d bn ml1 br2 bg-blue items-center align-center justify-center flex pointer white fw6",children:"Done"})]})]}):(null==R?void 0:R.nRows)!==void 0?(0,r.jsxs)("div",{style:{margin:"0 -14px",height:ex.T6+16+2,borderBottomLeftRadius:ee&&et,borderBottomRightRadius:et},className:"jsx-fec60529c9a8369d "+(s()("mid-gray f7 flex items-center justify-between b--light-silver pa2",!(R.nRows>0)||(null==S?void 0:S.error)?"br bl bb":"ba")||""),children:[(0,ew.u2)(f)&&(0,r.jsx)("div",{className:"jsx-fec60529c9a8369d mr2",children:(0,ew.u2)(f)}),(0,r.jsxs)("div",{style:{padding:"2px"},className:"jsx-fec60529c9a8369d ba b--light-silver flex items-center br2",children:[(0,r.jsx)("button",{onClick:()=>{var e;return null===(e=ei.current)||void 0===e?void 0:e.focus()},className:"jsx-fec60529c9a8369d bn pa0 bg-transparent flex items-center gray pointer",children:(0,r.jsx)(v.Z,{})}),(0,r.jsx)("input",{ref:ei,value:A,style:{font:"13px/1.2 var(--sans-serif)"},disabled:!R.ready,onChange:e=>{U(e.target.value)},name:"search",placeholder:"Search",className:"jsx-fec60529c9a8369d bn fw5"})]}),(null==S?void 0:S.searchInfo)&&(0,r.jsx)("div",{className:"jsx-fec60529c9a8369d ml1",children:"".concat(S.searchInfo.length.toLocaleString()," ").concat(1===S.searchInfo.length?"match":"matches")}),(0,r.jsx)("div",{className:"jsx-fec60529c9a8369d ml-auto",children:(null!==(o=null===(t=C.filter)||void 0===t?void 0:t.length)&&void 0!==o?o:0)+(null!==(i=null===(n=C.sort)||void 0===n?void 0:n.length)&&void 0!==i?i:0)>0&&(0,r.jsx)("button",{onClick:()=>{let e={filter:void 0,sort:void 0};y(e),j({type:"setLocalOperations",id:w,operations:e})},className:"jsx-fec60529c9a8369d bn br2 f6 fw6 pv1 ph2 mr2 bg-white blue pointer",children:"Reset"})}),!x&&er&&(0,r.jsx)(u.Z,{className:"mid-gray mr1"}),(0,r.jsxs)("div",{style:{fontVariantNumeric:"tabular-nums"},className:"jsx-fec60529c9a8369d",children:[(null==_?void 0:_.nRows)!==void 0&&"".concat(_.nRows.toLocaleString()," of "),R.nRows.toLocaleString(),1===R.nRows?" row":" rows"]})]}):null,(0,r.jsx)(a(),{id:"fec60529c9a8369d",children:".container.jsx-fec60529c9a8369d{max-height:369px}table.jsx-fec60529c9a8369d{font:13px/1.2 var(--sans-serif);border-collapse:separate;border-spacing:0}input.jsx-fec60529c9a8369d::-webkit-input-placeholder{font-weight:500;color:var(--gray)}input.jsx-fec60529c9a8369d:-moz-placeholder{font-weight:500;color:var(--gray)}input.jsx-fec60529c9a8369d::-moz-placeholder{font-weight:500;color:var(--gray)}input.jsx-fec60529c9a8369d:-ms-input-placeholder{font-weight:500;color:var(--gray)}input.jsx-fec60529c9a8369d::-ms-input-placeholder{font-weight:500;color:var(--gray)}input.jsx-fec60529c9a8369d::placeholder{font-weight:500;color:var(--gray)}"})]})})},72382:function(e,t,n){n.d(t,{Z:function(){return Worker}});var r=n(85893),o=n(63999),a=n(64063),l=n.n(a),i=n(11163),s=n.n(i),c=n(67294),d=n(40123),u=n(4778),p=n(5146),m=n(7595),v=n(11026),f=n(78756),h=n(11252),y=n(96817),g=n(6434),b=n(44403),x=n(40591),w=n(68404),k=n(27507),j=n(90271),C=n(63302),S=n(32980),M=n(4870),R=n(29020),N=n(32219),_=n(60147);function isOptionalString(e){return void 0===e||"string"==typeof e}let D=new Map,E=0;function Worker(e){let{state:t,currentUser:n,dispatch:a,hiddenNodes:i,allowInternalNavigation:O=!0,location:L}=e,{id:I,owner:T,model:V,files:P,heights:F,workerTasks:A}=t,U=(0,R.DF)(t),Z=(0,R.cE)(t),B=(0,R.uT)(n,T),z=(0,S.xn)(n),q=(0,c.useRef)(),H=(0,c.useRef)(),W=(0,c.useRef)(),Y=(0,c.useRef)(),G=(0,c.useRef)(),$=(0,c.useRef)(),J=(0,c.useRef)(V.nodes[0]),X=(0,c.useRef)(),K=(0,c.useRef)(),Q=(0,c.useRef)(),ee=(0,c.useRef)(),et=(0,c.useRef)(),en=(0,c.useRef)(),er=(0,c.useRef)(),eo=(0,c.useRef)(),ea=(0,c.useRef)(new Map),el=(0,c.useRef)(),ei=(0,c.useRef)(t.saveVersion),es=(0,c.useRef)(V),ec=(0,c.useRef)(new Map);el.current=t.saveVersion,es.current=V;let{authorization:ed}=(0,_.v9)(e=>{let{authorization:t}=e;return{authorization:t}}),eu=ed.apiKey;function postRequest(e,t,n){let r,o;void 0===t&&void 0===n?(r=!1,o=new Promise((e,r)=>{t=e,n=r})):r=!0;let a=++E;return e.id=a,D.set(a,[t,n,r]),W.current(e),o}async function updateTitle(){let e=V.nodes[0].id,t=await postRequest({type:"extract_title",node_id:e});a({type:"title",value:"".concat(t).slice(0,255)})}function updatePath(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location,{pathname:n,search:r,hash:o}=t;(er.current!==n||eo.current!==o)&&(er.current=n,eo.current=o,e.push({type:"navigate",pathname:n,search:r,hash:o}))}function resolutionsSpecifierVersion(){return Math.min(ei.current,es.current.version)}function resolutionsSpecifier(){return"".concat(t.id,"@").concat(resolutionsSpecifierVersion())}function moduleURL(e){return e.toModuleURL(resolutionsSpecifier())}async function fetchResolutions(e){try{let{specifiers:t}=await (0,p.a8)("/document/".concat(e,"/imports?resolutions=").concat(resolutionsSpecifier(),"&importer=").concat(Z?T.login:"anonymous"),{signal:en.current});return Object.entries(t).filter(e=>{let[,{owner:t}]=e;return t!==T.login}).map(e=>{let[t,{resolution:n}]=e;return{type:"notebook",specifier:t,value:n}})}catch(e){if(404===e.status)return[];throw e}}function alreadyCaptured(e){return void 0!==es.current.resolve("notebook",e)}function resolutionsAreSynced(){return!((0,m.QY)(t)&&(0,S.mG)(t))||el.current>=resolutionsSpecifierVersion()}function isPublicImport(e){return!Z||void 0!==e.login&&e.login!==T.login}async function resolveImport(e,t,n,r){let o={id:t,specifier:"".concat(n)};if(ea.current.set(e,o),r&&!alreadyCaptured(n)){let t=await fetchResolutions(n);if(ea.current.get(e)!==o)return;t.length&&function(e){for(let{specifier:t,value:n}of e)ec.current.set(t,n);a({type:"resolveDependencies",resolutions:e,trigger:"implicit",source:"cellEvaluation"})}(t)}if(isPublicImport(n)){o.module=moduleURL(n),maybeSendResolvedImports();return}o.needsToBeSigned=!0,maybeSignPrivateImports(),maybeSendResolvedImports()}function maybeSignPrivateImports(){if(resolutionsAreSynced())for(let[,e]of ea.current)e.needsToBeSigned&&(e.needsToBeSigned=!1,signPrivateImport(e))}async function signPrivateImport(e){try{var t,n;let{import_path:r,owner:o,secrets:a,database_clients:l,notification_clients:i}=await (t=e.specifier,n={signal:en.current},eu?(0,p.a8)("/document/".concat(I,"/").concat(t,"/embed/import?v=4&resolutions=").concat(resolutionsSpecifier()),{...n,...eu?{headers:{"Content-Type":"application/json",Authorization:"apikey ".concat(eu)}}:{}}):(0,p.a8)("/document/".concat(t,"/import?v=4&resolutions=").concat(resolutionsSpecifier()),n));o.id===T.id?(e.module="".concat("https://api.observablehq.com").concat(r),a&&await resolveSecrets(a),l&&resolveDatabases(l),i&&resolveNotifications(i)):e.module=moduleURL(M.Z.parse(e.specifier))}catch(t){if("AbortError"===t.name)return;e.error=t instanceof k.ZP&&404===t.status?"Notebook '".concat(e.specifier,"' not found"):t.message}maybeSendResolvedImports()}function maybeSendResolvedImports(){if(!resolutionsAreSynced())return;let e=W.current;for(let[t,n]of ea.current){let{id:r,specifier:o,module:a,error:l}=n;l?(e({type:"resolve_import",id:r,specifier:o,error:l}),ea.current.delete(t)):"string"==typeof a&&(e({type:"resolve_import",id:r,specifier:o,module:a}),ea.current.delete(t))}}async function resolveSecrets(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!Z)return;if(!e.length){void 0===K.current&&(K.current=null,n.unshift({type:"reset_secret",delay:!1}));return}K.current||(K.current=fetchSecrets());let r=W.current,o=X.current,a=K.current;e.some(e=>!o.has(e))&&(n.unshift({type:"reset_secret",delay:!0}),t=!0);let l=await a,i=[];for(let t of e)!o.has(t)&&(o.add(t),l.has(t)&&i.push([t,l.get(t)]));(i.length||t)&&r({type:"resolve_secrets",secrets:i})}async function fetchSecrets(){let e;if(eu)e=await (0,p.a8)("/document/".concat(t.id,"/secrets/embed"),{headers:{"Content-Type":"application/json",Authorization:"apikey ".concat(eu)}});else if("team"===T.type)e=await (0,p.a8)("/team/".concat(T.id,"/secrets"));else if(e=await (0,p.a8)("/user/secrets"),T.id!==(null==n?void 0:n.id))throw Error("access denied");return new Map(e.map(e=>{let{name:t,value:n}=e;return[t,n]}))}function resolveDatabases(e){if(Z)for(let t of e)Q.current.add(t)}function resolveNotifications(e){if(Z)for(let t of e)ee.current.add(t)}(0,c.useEffect)(()=>{function hashchanged(){let e=[];updatePath(e,L),e.length&&W.current({type:"bundle",events:e})}return addEventListener("hashchange",hashchanged),()=>removeEventListener("hashchange",hashchanged)},[L]),(0,c.useEffect)(()=>{function onFocus(){W.current({type:"blur"})}function onBlur(){if(document.activeElement===H.current){var e;a({type:"selectionClear"}),null===(e=window.getSelection())||void 0===e||e.removeAllRanges()}}return onBlur(),addEventListener("focus",onFocus),addEventListener("blur",onBlur),()=>{removeEventListener("focus",onFocus),removeEventListener("blur",onBlur)}},[a]);let ep=(0,y.y)(n,t,"current_user_emails");(0,c.useEffect)(()=>{if(n&&U){let{login:e,name:t,bio:r,home_url:o,avatar_url:a,identities:l}=n;et.current={login:e,name:t,bio:r,url:o,avatar:a,...ep&&{email:l.concat(n).map(e=>e.email).find(e=>!!e)}}}else et.current=void 0},[U,ep,n]),(0,c.useEffect)(()=>{let e=(0,C.vE)(T),t=new AbortController,n=[];O&&n.push({type:"allow_internal_navigation"});let r=document.createElement("iframe");r.style.width="calc(100% + ".concat(2*j.Mv,"px)"),r.style.margin="0 ".concat(-j.Mv,"px"),r.style.border="none",r.scrolling="no",r.sandbox=C.Ar,r.allow=C.sq,r.src="".concat(e,"/next/").concat(u.xF),addEventListener("message",messaged),q.current.appendChild(r);let o=r.contentWindow;function messaged(t){if(!t.isTrusted||t.origin!==e||t.source!==o)return;let l=t.data;if(void 0!==l.id){let{id:e}=l,t=D.get(e);if(t){let[n,r,o]=t,{error:a}=l;o?((void 0!==a||l.done)&&D.delete(e),void 0!==a?r(a):n(l)):(D.delete(e),void 0!==a?r(a):n(l.value));return}}switch(l.type){case"hello":(function(){if(n){for(let t of n)o.postMessage(t,e);n=null}})();return;case"resize":(function(e){let{node_id:t,height:n}=e;(0,w.qX)(a,e=>{let{heights:r}=e;return r.push({type:"worker",id:+t,height:+n})})})(l);return;case"hover":(function(e){let{node_id:t}=e;a({type:"hover",id:+t})})(l);return;case"errors":(function(e){let{errors:t}=e;if(t instanceof Map){for(let[e,n]of t)if("number"!=typeof e||null!==n&&!(isOptionalString(n.input)&&isOptionalString(n.stack)&&isOptionalString(n.message)&&isOptionalString(n.name)))return;a({type:"workerErrors",errors:t})}})(l);return;case"navigate":O&&function(e){let{pathname:t,search:n,hash:r}=e,o="".concat(t).concat(n).concat(r);s().push(o)}(l);return;case"display":(function(e){let{node_id:t,mode:n}=e;(0,f.I)(a,e=>{let{displayModes:r}=e;return r.set(+t,n)})})(l);return;case"pending":case"fulfilled":case"rejected":(function(e){let{type:t,node_id:n,suggestions:r,chartSpec:o}=e;(0,f.I)(a,e=>{let{statuses:a,suggestions:l,chartSpecs:i}=e;a.set(+n,"".concat(t)),void 0!==r&&l.set(+n,r),void 0!==o&&i.set(+n,o)})})(l);return;case"request_database_token":onRequestDatabaseToken(l.name);return;case"request_cloud_file":onRequestCloudFile(l.name);return;case"request_private_file":(function(e){let t=W.current;t(Z?B?{type:"resolve_private_file",name:e}:{type:"resolve_private_file",name:e,error:"Unable to load file: ".concat(e)}:{type:"resolve_private_file",name:e,error:d.Js})})(l.name);return;case"request_notification_client":onRequestNotificationClient(l.specifier);return;case"request_notification":(function(e){let{requestId:t,provider:n,address:r,content:o}=e,l=W.current;a({type:"addNotificationRequest",requestId:t,notification:{provider:n,address:r,content:o,onConfirm:e=>void l({type:"resolve_notification",requestId:t,status:e}),onReject:e=>void l({type:"resolve_notification",requestId:t,error:e})}})})(l);return;case"current_user":onCurrentUser();return;case"escape":document.activeElement===r&&(window.focus(),a({type:"blur"}));return}}async function onRequestDatabaseToken(e){let t;let n=W.current;if(!Z){n({type:"resolve_database_token",name:e,error:d.uW});return}if(!Q.current.has(e)){n({type:"resolve_database_token",name:e,error:"Database not allowed"});return}try{t=eu?await (0,p.Fv)("/document/".concat(I,"/data-connector/token/embed"),{name:e},{headers:{"Content-Type":"application/json",Authorization:"apikey ".concat(eu)}}):await (0,p.Fv)("".concat("team"===T.type?"/team/".concat(T.id):"/user","/data-connector/token"),{name:e})}catch(t){n({type:"resolve_database_token",name:e,error:"Database not found"});return}n({type:"resolve_database_token",name:e,token:t})}async function onRequestCloudFile(e){let t=W.current;if(!Z){t({type:"resolve_cloud_file",name:e,error:d.Px});return}let n=es.current.resolve("cloud_file",e);if(!n){t({type:"remove_file",name:e});return}try{let r=await (0,v.w)(T,{type:"cloud_file",specifier:e,value:n});t({type:"resolve_cloud_file",name:e,url:r})}catch(n){t({type:"resolve_cloud_file",name:e,error:n.message})}}async function onRequestNotificationClient(e){let t=W.current;if(!z){t({type:"resolve_notification_client",specifier:e,error:"Not available"});return}if(!Z){t({type:"resolve_notification_client",specifier:e,error:h.K.NOTIFICATION_PRIVATE_ERROR});return}if(!ee.current.has(e)){t({type:"resolve_notification_client",specifier:e,error:h.K.NOTIFICATION_DESTINATION_NOT_ALLOWED});return}let[n]=e.split(":");if("slack"===n)try{await (0,p.a8)("".concat("team"===T.type?"/team/".concat(T.id):"/user","/proxy/token?provider=slackNotifications")),t({type:"resolve_notification_client",specifier:e})}catch(n){t({type:"resolve_notification_client",specifier:e,error:h.K.NOTIFICATION_PROVIDER_NOT_AUTHORIZED})}else t({type:"resolve_notification_client",specifier:e})}async function onCurrentUser(){let e=W.current;await e({type:"current_user",currentUser:et.current})}return H.current=r,W.current=t=>{n?n.push(t):o.postMessage(t,e)},Y.current=-1,G.current=new Map,$.current=new Map,X.current=new Set,Q.current=new Set,ee.current=new Set,en.current=t.signal,()=>{a({type:"workerGoodbye"}),removeEventListener("message",messaged),W.current=void 0,Y.current=void 0,G.current=void 0,$.current=void 0,X.current=void 0,K.current=void 0,Q.current=void 0,ee.current=void 0,en.current=void 0,er.current=void 0,eo.current=void 0,H.current=void 0,r.remove(),r.src="about:blank",t.abort()}},[U,O,Z,T,a,i,eu,I,B,z]);let em=V.nodes.length-(i?i.length:0);return(0,c.useEffect)(()=>{if(!H.current)return;let e=(0,w.hY)(F)+(em+1)*j.KI;H.current.style.height="".concat(e,"px")},[em,F]),(0,c.useEffect)(()=>{let e=[],n=[],r=[],a=[],s=[];if(function(e,t,n,r,a,i,s,c,d,u,p){let m=e.current<0?o.Z.create(t).events.filter(e=>e):t.history.slice(e.current),v=new Set,f=!1;for(let o of m){let{type:m}=o;switch(m){case"modify_data":if(function(e){let{type:t,old_node_data:n,new_node_data:r}=e;return"modify_data"===t&&!l()(null==n?void 0:n.display,null==r?void 0:r.display)}(o)){let{node_id:e,new_node_data:t}=o;n.push({type:"modify_display",node_id:e,new_node_data:t});continue}case"mode_node":case"insert_node":case"modify_node":case"modify_name":{let{node_id:l,new_next_node_id:c,new_node_mode:d,new_node_data:f}=o,h=(0,N.Z)((0,x.DY)(t,l)||{value:"",mode:"js",name:null}),y={type:m,node_id:l,new_node_value:h,new_next_node_id:c,new_node_mode:d,new_node_data:f,hidden:null==p?void 0:p.includes(l)};"import"===h.type?r.push({nodeId:l,value:h,shouldCapture:e.current>=0&&o.version>u}):(h.secrets&&a.push(...h.secrets),h.databaseClients&&i.push(...h.databaseClients),h.notificationClients&&s.push(...h.notificationClients)),v.add(l),n.push(y);break}case"move_node":{let{node_id:e,new_next_node_id:t}=o;n.push({type:m,node_id:e,new_next_node_id:t});break}case"remove_node":{let{node_id:e}=o;n.push({type:m,node_id:e});break}case"resolve_dependency":{let{version:e,specifier:t,specifier_type:r,new_resolution:a}=o;if("cloud_file"===r)a?n.push({type:"insert_file",name:t,cloud:!0,mimeType:(0,b.L)(t)}):n.push({type:"remove_file",name:t});else if("notebook"===r){let n=d.get(t);n&&n===a?d.delete(t):c.current<e&&(f=!0,c.current=e)}}}}f&&function(e,t,n,r){for(let o of e.nodes){if(t.has(o.id))continue;t.add(o.id);let a=(0,N.Z)((0,x.DY)(e,o.id)||{value:"",mode:"js",name:null});"import"===a.type&&(n.push({nodeId:o.id,value:a,shouldCapture:!1}),r.push({type:"modify_node",node_id:o.id,new_node_value:a}))}}(t,v,r,n),e.current=t.history.length}(Y,V,e,n,r,a,s,ei,ec.current,t.saveVersion,i),function(e,t,n){if(e.current!==t){let r=e.current;for(let[o,a]of(e.current=t,t)){let e=r.get(o);if((0,g.ki)(a)){if((0,g.ki)(e)){if("pending"===e.status&&void 0===e.blob&&"pending"!==a.status){let{url:e,mimeType:t}=a;n.push({type:"modify_file",name:o,url:e,mimeType:t})}else if("pending"===e.status&&e.blob&&"pending"!==a.status&&e.mimeType!==a.mimeType){let{blob:e,mimeType:t}=a;n.push({type:"modify_file",name:o,blob:e,mimeType:t})}}else{let{url:e,blob:t,mimeType:r,privateBucketId:l}=a;n.push({type:"insert_file",name:o,url:e,blob:t,mimeType:r,privateBucketId:l})}}}for(let[e,o]of r){let r=t.get(e);!(0,g.ki)(r)&&(0,g.ki)(o)&&n.push({type:"remove_file",name:e})}}}(G,P,e),function(e,t,n){if(e.current!==t){let r=e.current;for(let[o,{editor:a,comments:l,display:i}]of(e.current=t,t)){let e=a+l+i,t=r.has(o)?r.get(o).editor+r.get(o).comments+r.get(o).display:0;t!==e&&n.push({type:"offset_node",node_id:o,height:e})}for(let[e,{editor:o}]of r)t.has(e)||0===o||n.push({type:"offset_node",node_id:e,height:0})}if(n.length){let e=new Map;for(let{type:r,node_id:o}of n)switch(r){case"insert_node":{let n=t.get(o);n&&e.set(o,n.editor+n.comments+n.display);break}case"remove_node":e.delete(o)}for(let[t,r]of e)n.push({type:"offset_node",node_id:t,height:r})}}($,F,e),function(e){for(let{nodeId:t,value:n,shouldCapture:r}of e){let e=M.Z.parse(n.specifier);null===e?n.module=n.specifier:(n.notebook=e.toNotebookURL(),isPublicImport(e)&&(!r||alreadyCaptured(e))&&resolutionsAreSynced()?n.module=moduleURL(e):(n.module=++E,resolveImport(t,n.module,e,r)))}}(n),resolveSecrets(r,e),resolveDatabases(a),resolveNotifications(s),updatePath(e,L),e.length&&W.current({type:"bundle",events:e}),function(e,t,n){let r=t.nodes[0];return!!(r!==e.current||n.some(e=>{let{type:t,node_id:n}=e;return"modify_node"===t&&n===r.id}))&&(e.current=r,!0)}(J,V,e)){let e=V.version>t.initialLatestVersion||V.version>t.saveVersion;e&&updateTitle()}(function(e){if(e.size)for(let t of[...e])e.delete(t),t.resolve(t.process(postRequest))})(A),maybeSignPrivateImports(),maybeSendResolvedImports()}),(0,r.jsx)("div",{ref:q})}},11026:function(e,t,n){n.d(t,{a:function(){return getCloudFileSpecifier},w:function(){return getCloudFileDownloadUrl}});var r=n(64487),o=n(40123),a=n(5146),l=n(90580);function getCloudFileSpecifier(e){let t=/^([a-zA-Z]+):\/\/(.*)$/.exec(e.specifier);if(!t)return null;let n=Object.entries(l.c).find(e=>{let[,{shorthand:n}]=e;return n===t[1]});return n?{provider:n[0],name:t[2],specifier:e.specifier,path:e.value}:null}async function getCloudFileDownloadUrl(e,t){let n=getCloudFileSpecifier(t);if(!n)throw(0,r.uT)("Invalid cloud file path: ".concat(t.value)),Error("Invalid cloud file path.");return getDownloadUrl(e,n)}async function getDownloadUrl(e,t){let n;try{let r="team"===e.type?"/team/".concat(e.id):"/user";n=await (0,a.Fv)("".concat(r,"/cloud-file/token"),{provider:t.provider,path:t.path})}catch(e){throw Error(o.t5)}return"".concat("https://connector.observableusercontent.com","/file?token=").concat(encodeURIComponent(n))}},87480:function(e,t,n){function download(e,t){let n=URL.createObjectURL(e);downloadUrl(n,t),URL.revokeObjectURL(n)}function downloadUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=document.createElement("a");n.style.display="none",n.href=e,n.download=t,document.body.appendChild(n),n.click(),n.remove()}n.d(t,{G:function(){return downloadUrl},L:function(){return download}})},44403:function(e,t,n){n.d(t,{L:function(){return mimeTypeFromFilename}});function mimeTypeFromFilename(e){let t=e.lastIndexOf(".");if(-1===t)return"application/octet-stream";switch(e.substring(t+1)){case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"bmp":return"image/bmp";case"json":return"application/json";case"db":return"application/x-sqlite3";case"zip":return"application/zip";case"css":return"text/css";case"csv":return"text/csv";case"txt":return"text/plain";case"html":return"text/html";case"js":return"text/javascript";case"mp3":return"audio/mpeg";case"mp4":return"video/mp4";case"tsv":return"text/tab-separated-values";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";default:return"application/octet-stream"}}},36869:function(e,t,n){n.d(t,{v:function(){return fuzzyMatcher}});let r={test:()=>!1,matches:()=>[]};let FuzzyMatcherImpl=class FuzzyMatcherImpl{test(e){if(!e)return!1;let t=0;for(let n of this.terms){if(n.lastIndex=t,!n.test(e))return this.fallback.test(e);t=n.lastIndex}return!0}matches(e){let t=this.fallback.matches(e);if(!e)return t;let n=0;for(let r of this.terms){r.lastIndex=n;let o=r.exec(e);if(!o)continue;let a=o.index+o[1].length,l=a+o[2].length;t.push([a,l]),n=r.lastIndex}return t}constructor({terms:e=[],strict:t=!1,fallback:n=r}){this.terms=e,this.strict=t,this.fallback=n}};function termRegExp(e,t){return new RegExp("(^|[^\\p{L}])(".concat(e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),")"),t)}function fuzzyMatcher(e){let{allowAcronyms:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=String(e).split(/\s+/g).filter(e=>e).map(e=>termRegExp(e,"iu"));return new FuzzyMatcherImpl({terms:n,fallback:1===n.length&&t?new FuzzyMatcherImpl({terms:Array.from(String(e).replace(/\s+/g,""),e=>termRegExp(e,"iug")),strict:!0}):void 0})}},68404:function(e,t,n){n.d(t,{Gv:function(){return outputHeight},hY:function(){return totalHeight},jn:function(){return heightObserver},qX:function(){return o}});var r=n(28174);function outputHeight(e){return e?e.worker+e.display:0}function totalHeight(e){let t=0;for(let{total:n}of e.values())t+=n;return t}function heightObserver(e,t,n,r){let a=0,l=new ResizeObserver(e=>{let[l]=e,i=l.contentRect.height;i!==a&&(a=i,o(r,e=>{let{heights:r}=e;return r.push({type:n,id:t,height:a})}))});return l.observe(e),{disconnect(){l.disconnect(),0!==a&&(a=0,o(r,e=>{let{heights:r}=e;return r.push({type:n,id:t,height:a})}))}}}let o=(0,r.J)(()=>({type:"cellHeight",heights:[]}))},44966:function(e,t,n){n.d(t,{Z:function(){return objectKey}});let r=0,o=new WeakMap;function objectKey(e){let t=o.get(e);return void 0===t&&o.set(e,t=r++),t}},65920:function(e,t,n){n.d(t,{O:function(){return loadCompare}});var r=n(11163),o=n.n(r);let loadCompare=(e,t)=>{let{base:n,target:r}=t,a="".concat(n.id).concat(n.version?"@".concat(n.version):""),l="".concat(r.id).concat(r.version?"@".concat(r.version):"");o().push("/compare/".concat(a,"...").concat(l))}},22127:function(e,t,n){let r;n.d(t,{C:function(){return A}});var o=n(4530),a=n(40591);let insertAnalytic=(e,t)=>{let{notebook:n,currentUser:r}=e,{type:a,id:l,trigger:i,source:s}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:insert",data:{cellIds:[l],trigger:i,source:s,before:"insertBefore"===a},eventVersion:3,notebook:n,currentUser:r}))},moveAnalytic=(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:move",data:{cellIds:[a]},eventVersion:3,notebook:n,currentUser:r}))},splitAnalytic=(e,t)=>{let{notebook:n,currentUser:r}=e,{type:l,id:i,trigger:s}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:split",data:{cellIds:[i],mode:(0,a.DY)(n.model,i).mode,trigger:s,source:"nodeEditor",before:"splitBefore"===l},eventVersion:1,notebook:n,currentUser:r}))};function truncate(e,t){return e.length>t?"".concat(e.slice(0,t-1),"…"):e}var l=n(63302),i=n(49817),s=n(26886);function sendPaneDismissedEvent(e,t,n,r){switch(e){case"aiassist":(0,o.MR)((0,o.ym)({type:"notebook:view:assistPaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"help":(0,o.MR)((0,o.ym)({type:"notebook:view:helpPaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"files":(0,o.MR)((0,o.ym)({type:"notebook:view:filesPaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"history":(0,o.MR)((0,o.ym)({type:"notebook:view:historyPaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"minimap":(0,o.MR)((0,o.ym)({type:"notebook:view:minimapPaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"find":(0,o.MR)((0,o.ym)({type:"notebook:view:findPaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"dependencies":(0,o.MR)((0,o.ym)({type:"notebook:view:dependenciesPaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"guide":(0,o.MR)((0,o.ym)({type:"notebook:view:guidePaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"databases":(0,o.MR)((0,o.ym)({type:"notebook:view:databasesPaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}));break;case"schedule":(0,o.MR)((0,o.ym)({type:"notebook:view:schedulePaneDismissed",data:{newPaneOpened:t},eventVersion:1,notebook:n,currentUser:r}))}}var c=n(7026),d=n(6359),u=n(4640),p=n(32007),m=n(42962);let v=[{pattern:RegExp("^@notebook show columns from ((?<tableName>\\w+))$"),handler:(e,t)=>{let{dispatch:n,nodeId:r,notebook:o}=e,{tableName:l}=t;if(!l)return Promise.resolve("");let i=null!==r?(0,a.DY)(o.model,r):null;if(i&&"sql"===i.mode){let e=(0,p.VQ)(i.data);if(!e)return Promise.resolve("");let t=new d.n4(e,l,i.mode,void 0,void 0,i.id);return t.run(n).then(e=>JSON.stringify(Object.fromEntries(e)),e=>(console.error("Error fetching schema for chat: ",e),""))}return Promise.resolve("")}},{pattern:/^@notebook show tables$/,handler:e=>{let{dispatch:t,nodeId:n,notebook:r}=e,o=null!==n?(0,a.DY)(r.model,n):null;if(o&&"sql"===o.mode){let e=(0,p.VQ)(o.data);if(!e)return Promise.resolve("");let n=new d.Y2(e),r=(0,p.w4)((0,c.yD)(e.dialect)?"duckdb":(0,p.h8)(e.dialect));return n.run(t).then(e=>JSON.stringify({dialect:r,tables:e.map(e=>(0,m.Vi)(e))}),e=>(console.error("Error fetching schema for chat: ",e),""))}return Promise.resolve("")}},{pattern:/^@notebook show schemas$/,handler:e=>{let{dispatch:t,notebook:n}=e;async function getCellSchemas(){let e=[],n=new u.S(async(t,n)=>{t({type:"request_data_sources",mode:"table"});try{for await(let t of n()){let{name:n,dialect:r}=t,o={name:"".concat(n),type:"cell",dialect:(0,p.Ov)(r)};e.push(o)}}catch(e){console.error("Error fetching cell schemas: ",e)}});for(let r of(await n.run(t),e)){let e=new d.n4(r,"unknown","table");try{r.schema=JSON.stringify(Object.fromEntries(await e.run(t)))}catch(e){console.error("Error fetching schema for cell: ",r.name)}}return JSON.stringify(e)}return r&&r.id===n.id&&r.version===n.model.version?r.results:(r={id:n.id,version:n.model.version,results:getCellSchemas()}).results}}];var f=n(46047),h=n(36891),y=n(843),g=n(43318),b=n(65920),x=n(78546),w=n(45495),k=n(87480);let downloadNotebook=async e=>{let{notebook:t}=e,{id:n,saveVersion:r}=t,o=await fetch("".concat("https://api.observablehq.com","/document/").concat(n,"@").concat(r,"/download?v=3"),{credentials:"include"}),{tarball_path:a}=await o.json();(0,k.G)("".concat("https://api.observablehq.com").concat(a))};var j=n(9039),C=n(73466),S=n(80833),M=n(66652),R=n(47716),N=n(82244),_=n(90772),D=n(30743),E=n(28826),O=n(85478),L=n(33251);let setNotebookDataConnectorListener=async(e,t,n)=>{let{context:{context:r},notebook:{focusId:o,model:{nodes:a}}}=e,{dataConnector:l,nodeId:i}=t,{name:s}=l;n({type:"showProcessingToast",key:"setDataConnector",message:'Saving data connector "'.concat(s,'"…')});try{await (0,L.qE)(l,null==r?void 0:r.id),n({type:"showSuccessToast",key:"setDataConnector",message:'Saved data connector "'.concat(s,'".')});let e=void 0!==i?i:null!==o?o:a[a.length-1].id;n({type:"insertAfter",id:e,node:{mode:"sql",data:{source:{type:"database",name:s}}},trigger:"Implicit",source:"dataConnectorModal"})}catch(e){n({type:"showErrorToast",key:"setDataConnector",message:"Oops, saving data connector failed. Try again?"})}};var I=n(90805),T=n(59771),V=n(34513),P=n(10327),F=n(5634);let A={acceptCompletion:(e,t)=>{let{notebook:n,currentUser:r}=e,{origin:a}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:acceptCompletion",data:{origin:a},eventVersion:1,notebook:n,currentUser:r}))},acceptSnippet:T.eY,acknowledgeSuggestionClosed:P.G6,addedDatabase:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:addDatabase",data:{cellIds:[a]},eventVersion:1,notebook:n,currentUser:r}))},chatFeedback:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a,feedback:l,reason:i}=t;l&&(0,o.MR)((0,o.ym)({type:"notebook:assist:feedback",data:{chatId:a,feedback:l,reason:i||"none"},eventVersion:1,notebook:n,currentUser:r}))},chatsReceived:(e,t,n)=>{let{notebook:r,currentUser:o}=e,{chats:a}=t;for(let{id:e,ref_id:t,content:l,node_id:i}of a){if([...r.chatMessages,...a].find(t=>t.ref_id===e))continue;let s=function(e){for(let t of v){let n=t.pattern.exec(e);if(n)return{handler:t.handler,args:n.groups}}}(l.body[0].text);if(s){let a=r.chatMessages.find(e=>e.id===t);if(!a||!("local"in a))continue;s.handler({notebook:r,nodeId:i,dispatch:n},s.args||{}).then(t=>n({type:"chatSend",node_id:i,ref_id:e,sender:o,content:{body:[{type:"system",text:t}]}}))}}},chatSendDraft:(e,t)=>{let{notebook:n,currentUser:r}=e,{scope:a,cellIncluded:l}=t;(0,o.MR)((0,o.ym)({type:"notebook:assist:draftsent",data:{scope:a,cellIncluded:l},eventVersion:1,notebook:n,currentUser:r}))},closeSuggestion:P.nK,closeSuggestionSucceeded:s.JB,cloudFileSnippet:x.zX,commentComposeCancel:(e,t)=>{var n;let{notebook:r,currentUser:a}=e,{nodeId:l,trigger:i,content:s,source:c}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:cancel",data:{cellIds:[l],length:s.length,trigger:i,source:c},eventVersion:4,notebook:r,currentUser:a})),r.comments.has(l)&&(null===(n=r.comments.get(l))||void 0===n?void 0:n.length)!==0||(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:hideComments",data:{cellIds:[l],cancelCompose:!0,trigger:i,source:"commentBox"},eventVersion:2,notebook:r,currentUser:a}))},commentComposeOpen:(e,t)=>{let{notebook:n,currentUser:r}=e,{nodeId:a,trigger:l,source:i}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:openCompose",data:{cellIds:[a],trigger:l,source:i},eventVersion:3,notebook:n,currentUser:r}))},commentCreated:(e,t)=>{let{notebook:n,currentUser:r}=e,{nodeId:a,source:i}=t,s=(0,l.o7)(n,a),c=(0,l.HS)(n,a),d=new Set;for(let e of c)d.add(e.user.id);for(let e of s)d.add(e.user.id);let u=c.some(e=>e.user.id===(null==r?void 0:r.id))||s.some(e=>e.user.id===(null==r?void 0:r.id));(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:submit",data:{cellIds:[a],commentsOnCell:c.length+s.length,unresolvedCommentsOnCell:c.length,commentersOnCell:d.size,userHasCommentedOnCell:u,trigger:"click",source:i},eventVersion:4,notebook:n,currentUser:r}))},commentDeleted:(e,t)=>{let{notebook:n,currentUser:r}=e,{comment:a,trigger:l,source:i}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:delete",data:{cellIds:[a.node_id],userIsCommentAuthor:a.user.id===(null==r?void 0:r.id),trigger:l,source:i},eventVersion:3,notebook:n,currentUser:r}))},commit:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a,trigger:l,source:i}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:edit:evaluate",data:{cellIds:[a],trigger:l,source:i},eventVersion:6,notebook:n,currentUser:r})),gtag("event","Edit",{event_category:"Notebook"})},confirmNotificationRequest:R.Q1,copyDatabaseCode:x.ZG,copyFileCode:[j.Nz,s.Hf],disableAutosave:e=>{let{notebook:t,currentUser:n}=e;(0,o.MR)((0,o.ym)({type:"notebook:view:autosaveDisabled",eventVersion:1,notebook:t,currentUser:n}))},dismissPane:e=>{let{notebook:t,page:n,currentUser:r}=e;null!==n.pane&&sendPaneDismissedEvent(n.pane,null,t,r)},dismissWelcomeMatBanner:()=>{(0,o.MR)((0,o.a$)({type:"marketing:view:dismissWelcomeBanner",data:{experiment:null},eventVersion:1,currentUser:null}))},dragEnded:moveAnalytic,downloadCode:[downloadNotebook,s.kg],downloadCloudFile:x.Tv,downloadFile:s.lA,exitVersionedMode:h.Q,createDocumentKey:w.H,fileMarkedForDeletion:s.hO,replaceFile:j.bC,fileReplaced:s.tq,focusDefinition:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a,trigger:l,source:i}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:view:focusDefinition",data:{cellIds:[a],trigger:l,source:i},eventVersion:1,notebook:n,currentUser:r}))},focusError:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:view:focusError",data:{cellIds:[a]},eventVersion:1,notebook:n,currentUser:r}))},forkRequested:C.J1,embedModalCopy:s.M6,helpPaneLinkClicked:(e,t)=>{let{notebook:n,currentUser:r}=e,{section:a,url:l}=t;(0,o.MR)((0,o.ym)({type:"notebook:view:helpPaneLink",data:{section:a,url:l},eventVersion:1,notebook:n,currentUser:r}))},hideComments:(e,t)=>{let{notebook:n,currentUser:r}=e,{nodeId:a,trigger:l,source:i}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:hideComments",data:{cellIds:[a],cancelCompose:!1,trigger:l,source:i},eventVersion:2,notebook:n,currentUser:r}))},insertAfter:insertAnalytic,insertBefore:insertAnalytic,insertCloudFile:x.Xm,insertDatabase:x._E,insertFile:s.Nl,insertSnippet:T.ns,like:M.v,liked:(e,t)=>{let{notebook:n,currentUser:r}=e,{liked:a}=t;(0,o.MR)((0,o.ym)({type:a?"notebook:social:like":"notebook:social:unlike",data:{},eventVersion:4,notebook:n,currentUser:r})),gtag("event","Like",{event_category:"Social"})},loadCompare:[b.O,(e,t)=>{let n,{notebook:r,currentUser:a}=e,{trigger:l,source:i,base:s,target:c,loadType:d}=t;if("reverse"!==d){switch(d){case"fork":n="notebook:view:compareFork";break;case"latest":n="notebook:view:compareLatest";break;case"published":n="notebook:view:comparePublished"}(0,o.MR)((0,o.ym)({type:n,data:{base:(0,o.tb)(s,a),target:(0,o.tb)(c,a),trigger:l,source:i},eventVersion:1,notebook:r,currentUser:a}))}}],loadVersion:S.n,loadedVersion:(e,t)=>{let{notebook:n,currentUser:r}=e,{body:a}=t;(0,o.MR)((0,o.ym)({type:"notebook:view:historyNavigate",data:{loadedVersion:a.version,navigationType:"version"},eventVersion:5,notebook:n,currentUser:r}))},attachLocalFiles:j.Mq,localFilesAttached:s.fe,moveDown:moveAnalytic,moveUp:moveAnalytic,notebookFilePickerOpened:s.Bv,openHelpArticle:(e,t)=>{let{notebook:n,currentUser:r}=e,{article:a}=t;(0,o.MR)((0,o.ym)({type:"notebook:view:helpArticleOpened",data:{article:a},eventVersion:1,notebook:n,currentUser:r}))},closeInsertMenu:(e,t)=>{let{notebook:n,currentUser:r}=e,{trigger:a,filter:l,selectedItem:i,ignoreInAnalytics:s}=t;s||(void 0!==i&&(i=truncate(i,50)),(0,o.MR)((0,o.ym)({type:"notebook:view:nodeInserterMenuClosed",data:{trigger:a,filter:truncate(l,50),selectedItem:i},eventVersion:1,notebook:n,currentUser:r})),gtag("event","Node inserter menu",{event_category:"Notebook",event_label:i}))},openInsertMenu:(e,t)=>{let{notebook:n,currentUser:r}=e,{before:a,trigger:l,source:i}=t;(0,o.MR)((0,o.ym)({type:"notebook:view:nodeInserterMenuOpened",data:{trigger:l,source:i,before:a},eventVersion:1,notebook:n,currentUser:r}))},pauseLiveEdits:_.Dq,pauseLiveEditsSuccess:_.Z6,relicense:s.mB,remove:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:l}=t,i=(0,a.DY)(n.model,l);(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:delete",data:{cellIds:[l],includesLastCell:1===n.model.nodes.length,mode:null==i?void 0:i.mode},eventVersion:5,notebook:n,currentUser:r}))},requestSnippets:T.d1,removeCloudFile:x.kc,resolveComments:(e,t)=>{let{notebook:n,currentUser:r}=e,{nodeId:a,trigger:i,source:s}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:resolve",data:{cellIds:[a],commentCount:(0,l.HS)(n,a).length,trigger:i,source:s},eventVersion:3,notebook:n,currentUser:r}))},resumeLiveEdits:_.gY,resumeLiveEditsSuccess:_.SK,revertRequested:D._$,replaceCurrent:(e,t)=>{let{notebook:n,currentUser:r}=e,{trigger:a,source:l}=t,{caseSensitiveSearch:s,wholeWordSearch:c,regexSearch:d}=n;(0,o.MR)((0,o.ym)({type:"notebook:edit:replaceCurrent",data:{numSearchResults:(0,i.n)(n.searchResults),caseSensitiveSearch:s,wholeWordSearch:c,regexSearch:d,trigger:a,source:l},eventVersion:1,notebook:n,currentUser:r}))},replaceAll:[E.Rt,(e,t)=>{let{notebook:n,currentUser:r}=e,{trigger:a,source:l}=t,{caseSensitiveSearch:s,wholeWordSearch:c,regexSearch:d}=n;(0,o.MR)((0,o.ym)({type:"notebook:edit:replaceAll",data:{numSearchResults:(0,i.n)(n.searchResults),caseSensitiveSearch:s,wholeWordSearch:c,regexSearch:d,trigger:a,source:l},eventVersion:1,notebook:n,currentUser:r}))}],reportAbuse:g.e5,selectionCut:O.S2,selectionCopy:O.S2,selectionInsert:(e,t)=>{let{notebook:n,currentUser:r}=e,{trigger:l,before:i=!1,inherit:s=!1}=t,{selectionFocusId:c}=n;null!==c&&(0,o.MR)(s?(0,o.ym)({type:"notebook:cells:manage:split",data:{cellIds:[c],mode:(0,a.DY)(n.model,c).mode,trigger:l,source:"nodeSelection",before:i},eventVersion:1,notebook:n,currentUser:r}):(0,o.ym)({type:"notebook:cells:manage:insert",data:{cellIds:[c],trigger:l,source:"nodeSelection",before:i},eventVersion:3,notebook:n,currentUser:r}))},sendSuggestion:P.gd,sendSuggestionFailed:s.Hh,sendSuggestionSucceeded:s.yy,setAuthorAcceptance:f.jp,setAuthors:f.Yx,setMode:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a,source:l,trigger:i,mode:s}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:setMode",data:{cellIds:[a],source:l,trigger:i,mode:s},eventVersion:1,notebook:n,currentUser:r}))},setChartConfig:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a,config:l,options:i,source:s}=t,c=l&&Object.keys(l).filter(e=>"options"!==e).map(e=>{var t,n,r;return"mark"===e?{key:e,value:null===(t=l[e])||void 0===t?void 0:t.value}:{key:e,type:null===(n=l[e])||void 0===n?void 0:n.type,reduce:null===(r=l[e])||void 0===r?void 0:r.reduce}}),d=i&&Object.keys(i);(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:setChartConfig",data:{cellIds:[a],config:c,options:d,source:s},eventVersion:1,notebook:n,currentUser:r}))},setDataConnector:setNotebookDataConnectorListener,setDataSource:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a,source:l}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:setDataSource",data:{cellIds:[a],source:l.type},eventVersion:1,notebook:n,currentUser:r}))},setDataOperations:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:l,operations:i,source:s="editor"}=t;if((0,o.MR)((0,o.ym)({type:"notebook:cells:manage:setDataOperations",data:{cellIds:[l],operations:Object.keys(i),source:s},eventVersion:3,notebook:n,currentUser:r})),"derive"in i){var c,d,u,p;let e=(0,a.DY)(n.model,l),t=(null!==(u=null===(c=i.derive)||void 0===c?void 0:c.length)&&void 0!==u?u:0)-(null!==(p=null==e?void 0:null===(d=e.data.operations.derive)||void 0===d?void 0:d.length)&&void 0!==p?p:0);t>0?(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:tableDerive",data:{cellIds:[l],eventType:"add"},eventVersion:1,notebook:n,currentUser:r})):t<0&&(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:tableDerive",data:{cellIds:[l],eventType:"delete"},eventVersion:1,notebook:n,currentUser:r}))}},setLocalOperations:(e,t)=>{var n,r,l,i,s;let{notebook:c,currentUser:d}=e,{id:u,operations:p}=t,m=null===(n=(0,a.DY)(c.model,u))||void 0===n?void 0:n.mode,v=null!==(i=null===(r=p.filter)||void 0===r?void 0:r.map(e=>{let{type:t}=e;return t}))&&void 0!==i?i:null,f=null!==(s=null===(l=p.sort)||void 0===l?void 0:l.map(e=>{let{direction:t}=e;return t}))&&void 0!==s?s:null;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:setLocalOperations",data:{cellIds:[u],filter:v,sort:f,mode:m},eventVersion:1,notebook:c,currentUser:d}))},setName:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:l,source:i}=t,s=(0,a.DY)(n.model,l);if(!s)return;let{mode:c}=s;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:setName",data:{cellIds:[l],source:i,trigger:"keypress",mode:c},eventVersion:1,notebook:n,currentUser:r}))},setOpenCollection:[N.Ge,e=>{let{notebook:t,currentUser:n}=e;(0,o.MR)((0,o.ym)({type:"notebook:view:changeCurrentCollection",data:{trigger:"click",source:"collectionsSidebar"},eventVersion:1,notebook:t,currentUser:n}))}],setSchedule:I.A,showModal:[F.k,(e,t)=>{let{currentUser:n,notebook:r}=e;switch(t.modal){case"license":(0,o.MR)((0,o.ym)({type:"notebook:view:licenseModal",data:{},eventVersion:2,notebook:r,currentUser:n}));break;case"addDatabase":(0,o.MR)((0,o.ym)({type:"notebook:view:addDatabaseModal",data:{},eventVersion:1,notebook:r,currentUser:n}));break;case"addCloudFile":(0,o.MR)((0,o.ym)({type:"notebook:view:cloudProviderModal",data:{},eventVersion:1,notebook:r,currentUser:n}));break;case"cloudFile":{let{provider:e}=t.modalProps;(0,o.MR)((0,o.ym)({type:"notebook:view:cloudFileModal",data:{provider:e},eventVersion:1,notebook:r,currentUser:n}));break}case"replaceFile":(0,o.MR)((0,o.ym)({type:"notebook:view:replaceFileModal",data:{},eventVersion:1,notebook:r,currentUser:n}));break;case"embed":(0,o.MR)((0,o.ym)({type:"notebook:manage:embedModalOpen",data:{trigger:"click",source:t.source},eventVersion:3,notebook:r,currentUser:n}))}}],showComments:(e,t)=>{let{notebook:n,currentUser:r}=e,{nodeId:a,trigger:l,source:i}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:showComments",data:{cellIds:[a],trigger:l,source:i},eventVersion:2,notebook:n,currentUser:r}))},showPane:N._k,showFindPane:E.zI,splitBefore:splitAnalytic,splitAfter:splitAnalytic,dismissSuggestionOpenBanner:e=>{let{notebook:t,currentUser:n}=e;(0,o.MR)((0,o.ym)({type:"notebook:view:suggestionOpenBannerDismissed",data:{base:(0,o.tb)(t.forkOf,n),target:(0,o.tb)(t,n)},eventVersion:1,notebook:t,currentUser:n}))},resolveDependencies:s.hX,showNotebookDependencyDetails:s.dX,signatureHelp:(e,t)=>{var n;let{notebook:r,currentUser:l}=e,{id:i,data:s}=t,{model:c,signatureHelpDismissedSpan:d}=r,u=(0,a.DY)(c,i),p=null==s?void 0:null===(n=s.applicableSpan)||void 0===n?void 0:n.start;if(!u||p&&p===d)return;let m=void 0!==p&&void 0===r.signatureHelpData;m&&(0,o.MR)((0,o.ym)({type:"notebook:cells:view:showSignatureHelp",eventVersion:2,notebook:r,currentUser:l}))},signatureHelpDismiss:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:l,source:i}=t,{model:s,signatureHelpData:c}=n,d=(0,a.DY)(s,l);d&&c&&(0,o.MR)((0,o.ym)({type:"notebook:cells:view:dismissSignatureHelp",data:{source:i},eventVersion:1,notebook:n,currentUser:r}))},tableDisplayError:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:view:tableDisplayError",data:{cellIds:[a]},eventVersion:1,notebook:n,currentUser:r}))},tableSearch:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:a}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:manage:tableSearch",data:{cellIds:[a]},eventVersion:2,notebook:n,currentUser:r}))},toggleHelpPaneSection:(e,t)=>{let{notebook:n,page:r,currentUser:a}=e,{section:l}=t;r.helpPaneSectionsOpen.has(l)?(0,o.MR)((0,o.ym)({type:"notebook:view:helpPaneSectionCollapsed",data:{section:l},eventVersion:1,notebook:n,currentUser:a})):(0,o.MR)((0,o.ym)({type:"notebook:view:helpPaneSectionExpanded",data:{section:l},eventVersion:1,notebook:n,currentUser:a}))},toggleCollectionsSidebar:e=>{let{notebook:t,currentUser:n,page:r}=e;(0,o.MR)((0,o.ym)({type:r.collectionsSidebarOpen?"notebook:view:collectionsSidebarDismissed":"notebook:view:collectionsSidebarOpened",data:{},eventVersion:1,notebook:t,currentUser:n}))},toggleDependencyLock:s.JS,upgradeDependency:s.Nz,togglePane:[N.Ez,(e,t)=>{let{page:n,notebook:r,currentUser:a}=e,{pane:l}=t;n.pane===l?sendPaneDismissedEvent(l,null,r,a):(n.pane&&sendPaneDismissedEvent(n.pane,l,r,a),function(e,t,n){switch(e){case"aiassist":(0,o.MR)((0,o.ym)({type:"notebook:view:assistPaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}));break;case"help":(0,o.MR)((0,o.ym)({type:"notebook:view:helpPaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}));break;case"files":(0,o.MR)((0,o.ym)({type:"notebook:view:filesPaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}));break;case"history":(0,o.MR)((0,o.ym)({type:"notebook:view:historyOpen",data:{},eventVersion:5,notebook:t,currentUser:n}));break;case"minimap":(0,o.MR)((0,o.ym)({type:"notebook:view:minimapPaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}));break;case"find":(0,o.MR)((0,o.ym)({type:"notebook:view:findPaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}));break;case"dependencies":(0,o.MR)((0,o.ym)({type:"notebook:view:dependenciesPaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}));break;case"guide":(0,o.MR)((0,o.ym)({type:"notebook:view:guidePaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}));break;case"databases":(0,o.MR)((0,o.ym)({type:"notebook:view:databasesPaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}));break;case"schedule":(0,o.MR)((0,o.ym)({type:"notebook:view:schedulePaneOpened",data:{},eventVersion:1,notebook:t,currentUser:n}))}}(l,r,a))}],togglePin:(e,t)=>{let{notebook:n,currentUser:r}=e,{id:l}=t,i=!(0,a.DY)(n.model,l).pinned;(0,o.MR)((0,o.ym)({type:i?"notebook:cells:manage:pin":"notebook:cells:manage:unpin",data:{cellIds:[l]},eventVersion:3,notebook:n,currentUser:r}))},toggleResolvedComments:(e,t)=>{let{notebook:n,currentUser:r}=e,{nodeId:a,trigger:l,source:i}=t;(0,o.MR)((0,o.ym)({type:"notebook:cells:comment:toggleResolved",data:{cellIds:[a],expanded:!n.expandedResolvedComments.has(a),trigger:l,source:i},eventVersion:2,notebook:n,currentUser:r}))},updateCommentingLock:[y.h,s.F5],updateSubscription:V.M,updateSubscriptionSucceeded:(e,t)=>{let{notebook:n,currentUser:r}=e,{status:a,trigger:l,source:i}=t;void 0!==l&&(0,o.MR)((0,o.ym)({type:"notebook:social:updateSubscription",data:{status:a,trigger:l,source:i},eventVersion:1,notebook:n,currentUser:r}))},welcomeMatNotebookClick:(e,t)=>{let{currentUser:n}=e,{clickedNotebookId:r}=t;(0,o.MR)((0,o.a$)({type:"marketing:view:welcomeMatNotebookClick",data:{clickedNotebookId:r},eventVersion:1,currentUser:n}))}}},28996:function(e,t,n){n.d(t,{c:function(){return initialPageState},q:function(){return l}});var r=n(82244),o=n(32007),a=n(28826);function initialPageState(){let{initialCollection:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{pane:null,collectionsSidebarOpen:!!e,suggestionOpenBannerDismissed:!1,helpPaneSectionsOpen:r.y3,helpArticlesOpen:[],replaceInputExpanded:!1,findOptionsInputExpanded:!1,guide:null,expandedDatabases:new Set,expandedTables:new Set,databaseSchemas:new Map,tableSchemas:new Map}}let l={togglePane:r.lx,dismissPane:r.rE,toggleCollectionsSidebar:r.P4,openCollectionsSidebar:r._O,dismissSuggestionOpenBanner:()=>({suggestionOpenBannerDismissed:!0}),collectionsUpdated:r.Yd,toggleHelpPaneSection:r.GJ,closeHelpArticle:r.Gr,openHelpArticle:r.LZ,showNotebookDependencyDetails:(e,t)=>{let{specifier:n}=t;return{pane:"dependencies",dependenciesPaneSpecifier:n}},removeDependenciesPaneSpecifier:()=>({dependenciesPaneSpecifier:void 0}),toggleFindOptionsExpanded:a.lc,toggleReplaceInputExpanded:a.$k,toggleDatabasesPaneDatabase:(e,t)=>{let{expandedDatabases:n}=e,{db:r}=t,a=(0,o.x2)(r);return(n=new Set(n)).has(a)?n.delete(a):n.add(a),{expandedDatabases:n}},toggleDatabasesPaneTable:(e,t)=>{let{expandedTables:n}=e,{db:r,table:a}=t,l=(0,o.hS)(r,a);return(n=new Set(n)).has(l)?n.delete(l):n.add(l),{expandedTables:n}},updateDatabasesPaneDatabaseSchema:(e,t)=>{let{databaseSchemas:n}=e,{db:r,tables:a}=t;return(n=new Map(n)).set((0,o.x2)(r),a),{databaseSchemas:n}},updateDatabasesPaneTableSchema:(e,t)=>{let{tableSchemas:n}=e,{db:r,table:a,columns:l}=t;return(n=new Map(n)).set((0,o.hS)(r,a),l),{tableSchemas:n}},refreshDatabasesPaneSchema:(e,t)=>{let{expandedDatabases:n,databaseSchemas:r,tableSchemas:a}=e,{db:l}=t;n=new Set(n),r=new Map(r),a=new Map(a);let i=(0,o.x2)(l);n.add(i);let s=r.get(i);if(r.delete(i),s)for(let e of s)a.delete((0,o.hS)(l,e));return{tableSchemas:a,databaseSchemas:r,expandedDatabases:n}}}},33251:function(e,t,n){n.d(t,{ZU:function(){return setDataConnectorListener},lA:function(){return setDataConnectorSucceededListenerAnalytic},my:function(){return setDataConnectorSucceededDataConnectorReducer},qE:function(){return postDataConnector}});var r=n(5146),o=n(4530);async function postDataConnector(e,t){let{allow_guests:n,credentials:o,local:a,name:l,type:i}=e;"bigquery"===i&&(o=o.connectionInfo||o),await (0,r.Fv)(t?"/team/".concat(t,"/data-connector"):"/user/data-connector",{allow_guests:n,credentials:o,local:a,name:l,type:i})}let setDataConnectorListener=async(e,t,n)=>{let{context:{context:r},dataConnectors:{dataConnectors:o}}=e,{dataConnector:a}=t,{local:l,name:i}=a;n({type:"showProcessingToast",key:"setDataConnector",message:'Saving data connector "'.concat(i,'"…')});try{await postDataConnector(a,null==r?void 0:r.id),n({type:"showSuccessToast",key:"setDataConnector",message:'Saved data connector "'.concat(i,'".')}),n({type:"setDataConnectorSucceeded",dataConnector:a}),l&&!o.some(e=>e.name===i)&&n({type:"resetDataConnectorSecret",dataConnector:a}),l||n({type:"testDataConnector",dataConnector:a})}catch(e){n({type:"showErrorToast",key:"setDataConnector",message:"Oops, saving data connector failed. Try again?"})}};function redactPassword(e){if(!("password"in e.credentials))return e;let{credentials:t}=e,n=""===t.password||void 0===t.password?void 0:null;return{...e,credentials:{...t,password:n}}}let setDataConnectorSucceededListenerAnalytic=(e,t)=>{let{context:n,currentUser:r,dataConnectors:a}=e,{dataConnector:l}=t,i=n.context,s=!a.dataConnectors.some(e=>e.name===l.name),c={type:l.type,local:l.local};i?(0,o.MR)((0,o.gv)({type:s?"team:manage:createDataConnectorData":"team:manage:updateDataConnectorData",data:c,eventVersion:1,team:i,currentUser:r})):(0,o.MR)((0,o.a$)({type:s?"user:manage:createDataConnectorData":"user:manage:updateDataConnectorData",data:c,eventVersion:1,currentUser:r}))},setDataConnectorSucceededDataConnectorReducer=(e,t)=>{let{dataConnectors:n}=e,{dataConnector:r}=t;return{dataConnectors:n=n.some(e=>e.name===r.name)?n.map(e=>e.name!==r.name?e:redactPassword(r)):[...n,redactPassword(r)].sort((e,t)=>e.name.localeCompare(t.name))}}},4778:function(e){e.exports=JSON.parse('{"xF":"worker-213a8f8b.html","Bl":"worker-embed-preview-4cda3f23.html"}')}}]);