"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3999],{64063:function(e){e.exports=function equal(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;if(Array.isArray(e)){if((o=e.length)!=n.length)return!1;for(i=o;0!=i--;)if(!equal(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if((o=(t=Object.keys(e)).length)!==Object.keys(n).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(n,t[i]))return!1;for(i=o;0!=i--;){var o,i,t,d=t[i];if(!equal(e[d],n[d]))return!1}return!0}return e!=e&&n!=n}},63999:function(e,n,o){function error(e){return new ModelError(e)}o.d(n,{Z:function(){return Model}});let ModelError=class ModelError extends Error{};function node_of({id:e,value:n="",pinned:o=!1,mode:i="js",data:t=null,name:d=null,combinePrevious:r,display:l}={}){if((e=+e)!=(0|e)||e<0)throw error("invalid node id");return null!==n&&(n+=""),null!==d&&(d+=""),new Node(e,n,!!o,i+"",t,d,r,l)}function Node(e,n,o,i,t,d,r,l){Object.defineProperties(this,{id:{value:e,enumerable:!0},value:{value:n,enumerable:!0},pinned:{value:o,enumerable:!0},mode:{value:i,enumerable:!0},data:{value:t,enumerable:!0},name:{value:d,enumerable:!0}}),r&&Object.defineProperties(this,{combinePrevious:{value:r,enumerable:!0}}),l&&Object.defineProperties(this,{display:{value:l,enumerable:!0}})}Object.defineProperties(Node,{of:{value:node_of,writable:!0,configurable:!0}});var i=o(64063);function resolutions_of(e){let n=new Set;return Array.from(e,e=>{let[o,i]=function({specifier:e,type:n,value:o}){if(null==e)throw error("invalid specifier");if(null==n)throw error("invalid specifier type");if(null==o)throw error("invalid resolution");return entry(n+"",e+"",o+"")}(e);if(n.has(o))throw error("duplicate resolution");return n.add(o),i})}function resolution_from({specifier:e,specifier_type:n,new_resolution:o}){if(null==e)throw error("invalid specifier");if(null==n)throw error("invalid specifier type");return entry(n+"",e+"",null==o?null:o+"")}function entry(e,n,o){return[resolution_key({type:e,specifier:n}),{type:e,specifier:n,value:o}]}function resolution_key({type:e,specifier:n}){return`${e}:${n}`}let t=new WeakMap;function resolution_map(e){let n=t.get(e);return void 0===n&&(n=new Map(e.map(e=>[resolution_key(e),e.value])),t.set(e,n)),n}let d="create",r="insert_node",l="modify_node",a="modify_title",_="move_node",s="remove_node",u="pin_node",p="unpin_node",w="resolve_dependency",v="revert",c="modify_license",f="modify_copyright",h="mode_node",m="modify_data",y="modify_name",b="noop";function ignore(){}function maybeUpdateCombinePrevious(e,n,o,i){if(null==o)return n;let t=n.findIndex(e=>e.id===o),d=n[t];return d.combinePrevious===i||(n===e.nodes&&(n=n.slice()),n[t]=new Node(d.id,d.value,d.pinned,d.mode,d.data,d.name,i,d.display)),n}function flip(e){let n=new Map;for(let[o,i]of e)n.set(i,o);return n}function intersect(e,n){return Array.from({length:Math.min(e.version,n.version)+1},(e,n)=>[n,n])}function List(e){Object.defineProperties(this,{_node:{value:e,writable:!0}})}function model_of({version:e=0,title:n="",license:o=null,copyright:i="",nodes:t=[],resolutions:d=[]}={}){if((e=+e)!=(0|e)||e<0)throw error("invalid version");null!==o&&(o+=""),t=Array.from(t,node_of),d=resolutions_of(d);let r=Array(e+1);for(let n=0;n<t.length;++n){let{id:o}=t[n];if(o>e)throw error("invalid node_id");if(o in r)throw error("duplicate node_id");r[o]=n}return new Model({version:e,title:n+"",license:o,copyright:i+"",nodes:t,events:Array(e+1),resolutions:d})}function redo_event(e){if(void 0===e)throw error("insufficient history");let{version:n,type:o,node_id:i,new_node_value:t,new_node_pinned:g,new_next_node_id:x,new_node_mode:k,new_node_data:P,new_node_name:M,specifier:O,specifier_type:j,new_resolution:N,new_combine:C,new_node_display:I}=e;switch(o){case a:return{version:n,type:o,new_node_value:t};case r:return{version:n,type:o,node_id:i,new_node_value:t,new_next_node_id:x,new_node_pinned:g,new_node_mode:k,new_node_data:P,new_node_name:M,new_combine:C,new_node_display:I};case s:return{version:n,type:o,node_id:i};case _:return{version:n,type:o,node_id:i,new_next_node_id:x,new_combine:C,new_node_display:I};case l:return{version:n,type:o,node_id:i,new_node_value:t};case u:case p:return{version:n,type:o,node_id:i};case c:case f:return{version:n,type:o,new_node_value:t};case h:return{version:n,type:o,node_id:i,new_node_mode:k,new_node_value:t,new_node_pinned:g,new_node_data:P,new_node_name:M};case m:return{version:n,type:o,node_id:i,new_node_data:P};case y:return{version:n,type:o,node_id:i,new_node_name:M};case w:return{version:n,type:o,specifier:O,specifier_type:j,new_resolution:N};case b:return{version:n,type:o};case d:throw error("cannot redo create");case v:throw error("cannot redo revert");default:throw error("unknown type")}}function Model({version:e,title:n,license:o,copyright:i,nodes:t,events:d,resolutions:r}){Object.defineProperties(this,{version:{value:e,enumerable:!0},title:{value:n,enumerable:!0},license:{value:o,enumerable:!0},copyright:{value:i,enumerable:!0},nodes:{value:t,enumerable:!0},events:{value:d,enumerable:!0},resolutions:{value:r,enumerable:!0}})}Object.defineProperties(List.prototype,{[Symbol.iterator]:{value:function(){return this},writable:!0,configurable:!0},next:{value:function(){if(null==this._node)return{done:!0};let e=this._node;return this._node=this._node.next,{done:!1,value:e}},writable:!0,configurable:!0}}),Object.defineProperties(Model,{create:{value:function({version:e,title:n="",nodes:o=[],license:i=null,copyright:t="",resolutions:l=[]}={}){o=Array.from(o,node_of),l=resolutions_of(l);let _=new Set,s=[];if(void 0!==e&&((e=+e)!=(0|e)||e<0))throw error("invalid version");let u=-1,p=-1;(n+="")&&(s[++u]={version:u,type:a,new_node_value:n}),null!==i&&(s[++u]={version:u,type:c,new_node_value:i+=""}),(t+="")&&(s[++u]={version:u,type:f,new_node_value:t});for(let e=0;e<o.length;e++){let n=o[e],{id:i,value:t,pinned:d,mode:l,data:a,name:w,combinePrevious:v,display:c}=n;if(v&&0===e)throw error("the first node cannot combine previous");if(_.has(i))throw error("duplicate node_id");_.add(i),s[++u]={version:u,type:r,node_id:i,new_next_node_id:null,new_node_value:t,new_node_pinned:d,new_node_mode:l,new_node_data:a,new_node_name:w,...v?{new_combine:"previous"}:null,...c?{new_node_display:c}:null},i>p&&(p=i)}for(let{type:e,specifier:n,value:o}of l)s[++u]={version:u,type:w,specifier:n,specifier_type:e,new_resolution:o};if(void 0===e)e=Math.max(u,p)+1;else if(u>=e||e<p)throw error("invalid version");return s[e]={version:e,type:d},new Model({version:e,title:n,nodes:o,events:s,license:i,copyright:t,resolutions:l})},writable:!0,configurable:!0},from:{value:function(e){let n="",o=-1,t=null,v="",g=-1,x=!1,k=new Map,P=new Map,M=null,O=null;function insert(e,n,o){let i=n?n.previous:M;switch(n?(e.next=n,n.previous=e):M=e,i?(e.previous=i,i.next=e):O=e,o){case"previous":e.combinePrevious=!0;break;case"next":if(e.next){if(e.next.combinePrevious)throw error("can only combine next at the beginning of a row");e.next.combinePrevious=!0}}}function remove(e){let n=e.next,o=e.previous;!e.combinePrevious&&n&&n.combinePrevious&&(n.combinePrevious=!1),e.combinePrevious=!1,n?(n.previous=o,e.next=null):M=o,o?(o.next=n,e.previous=null):O=n}for(let M of e){let e=+M.version;if(e!==(0|e)||!(e>=o))throw error("invalid version");switch(o=e,M.type){case d:if(x)throw error("duplicate create");if(g>o)throw error("invalid node_id");x=!0;break;case a:n=M.new_node_value;break;case r:{let e=o;if(void 0!==M.node_id){if((e=+M.node_id)!=(0|e)||e<0||x&&e>o)throw error("invalid node_id");if(k.has(e))throw error("duplicate node_id")}let n=null;if(null!=M.new_next_node_id&&void 0===(n=k.get(+M.new_next_node_id)))throw error("invalid new_next_node_id");g=Math.max(e,g);let i={id:e,value:M.new_node_value,pinned:M.new_node_pinned,mode:M.new_node_mode,data:M.new_node_data,name:M.new_node_name,display:M.new_node_display,next:null,previous:null};insert(i,n,M.new_combine),k.set(e,i);break}case l:{let e=k.get(+M.node_id);if(void 0===e)throw error("invalid node_id");e.value=M.new_node_value;break}case _:{let e=k.get(+M.node_id);if(void 0===e)throw error("invalid node_id");let n=null;if(null!=M.new_next_node_id&&void 0===(n=k.get(+M.new_next_node_id)))throw error("invalid new_next_node_id");let o=e.next?e.combinePrevious?"previous":!e.combinePrevious&&e.next.combinePrevious?"next":void 0:e.combinePrevious?"previous":void 0,t=e.display;o===M.new_combine&&i(t,M.new_node_display)&&(e.next===n||e===n)||(remove(e),insert(e,n,M.new_combine),e.display=M.new_node_display,M.new_node_display||delete e.display);break}case s:{let e=+M.node_id,n=k.get(e);if(void 0===n)throw error("invalid node_id");remove(n),k.delete(e);break}case u:case p:{let e=k.get(+M.node_id);if(void 0===e)throw error("invalid node_id");e.pinned=M.type===u;break}case h:{let e=k.get(+M.node_id);if(void 0===e)throw error("invalid node_id");e.mode=M.new_node_mode,void 0!==M.new_node_value&&(e.value=M.new_node_value),void 0!==M.new_node_pinned&&(e.pinned=M.new_node_pinned),void 0!==M.new_node_data&&(e.data=M.new_node_data),void 0!==M.new_node_name&&(e.name=M.new_node_name);break}case y:{let e=k.get(+M.node_id);if(void 0===e)throw error("invalid node_id");e.name=M.new_node_name;break}case m:{let e=k.get(+M.node_id);if(void 0===e)throw error("invalid node_id");e.data=M.new_node_data;break}case c:t=M.new_node_value;break;case f:v=M.new_node_value;break;case w:{let[e,n]=resolution_from(M);if(null!==n.value)P.set(e,n);else if(P.has(e))P.delete(e);else throw error("invalid resolution");break}case b:break;default:throw error("unknown type")}}if(!x)throw error("expected create");return model_of({version:o,title:n,license:t,copyright:v,nodes:new List(O),resolutions:P.values()})},writable:!0,configurable:!0},of:{value:model_of,writable:!0,configurable:!0},Node:{value:Node,writable:!0,configurable:!0},Error:{value:ModelError,writable:!0,configurable:!0}}),Object.defineProperties(Model.prototype,{apply:{value:function(e,n=ignore){let o=this.version,t=this.title,g=this.license,x=this.copyright,k=this.nodes,P=this.events,M=this.resolutions;for(let O of e){let e=o;switch(o=P.length,P===this.events&&(P=P.slice()),O.type){case a:{let i=void 0===O.new_node_value?"":O.new_node_value+"";if(t===i)break;n(P[P.length]={version:o,old_version:e,type:a,old_node_value:t,new_node_value:i}),t=i;continue}case r:{let i=o;if(void 0!==O.node_id){if((i=+O.node_id)!=(0|i)||i<0||i>o)throw error("invalid node_id");if(k.findIndex(e=>e.id===i)>=0)throw error("duplicate node_id")}let t=k.length,d=null;if(null!=O.new_next_node_id&&(d=+O.new_next_node_id,(t=k.findIndex(e=>e.id===d))<0))throw error("invalid new_next_node_id");let l=void 0===O.new_node_value?"":null===O.new_node_value?null:O.new_node_value+"",a=!!O.new_node_pinned,_=void 0===O.new_node_mode?"js":O.new_node_mode+"",s=null==O.new_node_data?null:O.new_node_data,u=null==O.new_node_name?null:O.new_node_name+"",p=null==O.new_combine?null:O.new_combine,w=null==O.new_node_display?null:O.new_node_display;k===this.nodes&&(k=k.slice());let v=new Node(i,l,a,_,s,u,"previous"===p,w);k.splice(t,0,v),"next"===p&&maybeUpdateCombinePrevious(this,k,d,!0),n(P[P.length]={version:o,old_version:e,type:r,node_id:i,new_next_node_id:d,new_node_value:v.value,new_node_pinned:v.pinned,new_node_mode:v.mode,new_node_data:v.data,new_node_name:v.name,...p?{new_combine:p}:null,...w?{new_node_display:w}:null});continue}case l:{let i=+O.node_id,t=k.findIndex(e=>e.id===i);if(t<0)throw error("invalid node_id");let d=k[t].value,r=void 0===O.new_node_value?"":null===O.new_node_value?null:O.new_node_value+"";if(d===r)break;k===this.nodes&&(k=k.slice()),k[t]=new Node(i,r,k[t].pinned,k[t].mode,k[t].data,k[t].name,k[t].combinePrevious,k[t].display),n(P[P.length]={version:o,old_version:e,type:l,node_id:i,old_node_value:d,new_node_value:r});continue}case _:{let t=+O.node_id,d=k.findIndex(e=>e.id===t);if(d<0)throw error("invalid node_id");let r=function(e,n){let o=e[n];if(n===e.length-1)return o.combinePrevious?"previous":void 0;let i=e[n+1];return o.combinePrevious?"previous":!o.combinePrevious&&i.combinePrevious?"next":void 0}(k,d),l=k[d].display,a=k[d],s=k.length,u=null;if(null!=O.new_next_node_id&&(u=+O.new_next_node_id,(s=k.findIndex(e=>e.id===u))<0))throw error("invalid new_next_node_id");let p=d<k.length-1?k[d+1].id:null;d===s&&(u=p),p!==u&&(k===this.nodes&&(k=k.slice()),k.splice(d,1),k.splice(s-(d<s),0,a));let w=O.new_combine,v=O.new_node_display;if(p===u&&w===r&&i(v,l))break;if(k=function(e,n,o,t,d){if(null==o)return n;let r=n.findIndex(e=>e.id===o),l=n[r],a=0===r?null:n[r-1],_=n.find(e=>e.id===t);return _&&!_.display?.presentation?.hidden&&d?.presentation?.hidden?d={...d,presentation:{hidden:!1}}:a&&a.display?.presentation?.hidden&&(d={...d,presentation:{hidden:!0}}),i(d,l.display)||(n===e.nodes&&(n=n.slice()),n[r]=new Node(l.id,l.value,l.pinned,l.mode,l.data,l.name,l.combinePrevious,d)),n}(this,k,t,u,v),"previous"===w){if(0===d&&s<=1||0===s)throw error("the first node cannot combine previous");k=maybeUpdateCombinePrevious(this,k,t,!0),"next"===r&&(k=maybeUpdateCombinePrevious(this,k,u,!1),null!=p&&p!==u&&(k=maybeUpdateCombinePrevious(this,k,u,!0),k=maybeUpdateCombinePrevious(this,k,p,!1)))}else if("next"===w){if(null===u)throw error("cannot combine right the last node");k=maybeUpdateCombinePrevious(this,k,u,!0),"previous"===r&&(k=maybeUpdateCombinePrevious(this,k,t,!1)),"next"===r&&(k=maybeUpdateCombinePrevious(this,k,p,!1))}else null==w&&(k=maybeUpdateCombinePrevious(this,k,t,!1),k=maybeUpdateCombinePrevious(this,k,u,!1),"next"===r&&(k=maybeUpdateCombinePrevious(this,k,p,!1)));n(P[P.length]={version:o,old_version:e,type:_,node_id:t,old_next_node_id:p,new_next_node_id:u,...r||w?{old_combine:r,new_combine:w}:null,...l||v?{old_node_display:l,new_node_display:v}:null});continue}case s:{let i=+O.node_id,t=k.findIndex(e=>e.id===i);if(t<0)throw error("invalid node_id");let d=t<k.length-1?k[t+1].id:null,r=k[t];k===this.nodes&&(k=k.slice()),k.splice(t,1),n(P[P.length]={version:o,old_version:e,type:s,node_id:i,old_next_node_id:d,old_node_value:r.value,old_node_pinned:r.pinned,old_node_mode:r.mode,old_node_data:r.data,old_node_name:r.name});continue}case u:case p:{let i=+O.node_id,t=k.findIndex(e=>e.id===i);if(t<0)throw error("invalid node_id");let d=O.type===u;if(k[t].pinned===d)break;k===this.nodes&&(k=k.slice()),k[t]=new Node(i,k[t].value,d,k[t].mode,k[t].data,k[t].name,k[t].combinePrevious,k[t].display),n(P[P.length]={version:o,old_version:e,type:O.type,node_id:i});continue}case h:{let i=+O.node_id,t=k.findIndex(e=>e.id===i);if(t<0)throw error("invalid node_id");let d=k[t].mode,r=O.new_node_mode+"";if(d===r)break;let l=k[t].value,a=void 0===O.new_node_value?l:null===O.new_node_value?O.new_node_value:O.new_node_value+"",_=k[t].pinned,s=void 0===O.new_node_pinned?_:!!O.new_node_pinned,u=k[t].name,p=void 0===O.new_node_name?u:null===O.new_node_name?O.new_node_name:O.new_node_name+"",w=k[t].data,v=void 0===O.new_node_data?w:O.new_node_data;k===this.nodes&&(k=k.slice()),k[t]=new Node(i,a,s,r,v,p,k[t].combinePrevious,k[t].display),n(P[P.length]={version:o,old_version:e,type:O.type,node_id:i,new_node_mode:r,old_node_mode:d,new_node_value:a,old_node_value:l,new_node_pinned:s,old_node_pinned:_,new_node_data:v,old_node_data:w,new_node_name:p,old_node_name:u});continue}case v:{o=+O.node_id;let i=new Model({version:e,title:t,nodes:k,events:P,license:g,copyright:x,resolutions:M});({version:o,title:t,nodes:k,license:g,copyright:x,resolutions:M}=i.reset(o,n)),P[P.length]={version:P.length,old_version:e,type:v,node_id:o};continue}case c:{let i=null==O.new_node_value?null:O.new_node_value+"";if(g===i)break;n(P[P.length]={version:o,old_version:e,type:c,old_node_value:g,new_node_value:i}),g=i;continue}case f:{let i=void 0===O.new_node_value?"":O.new_node_value+"";if(x===i)break;n(P[P.length]={version:o,old_version:e,type:f,old_node_value:x,new_node_value:i}),x=i;continue}case w:{let[i,{specifier:t,type:d,value:r}]=resolution_from(O),l=M.findIndex(e=>resolution_key(e)===i);if(l>=0&&M[l].value===r||l<0&&null===r)break;M===this.resolutions&&(M=M.slice());let a=l<0?null:M[l].value;null===r?M.splice(l,1):l<0?M.push({specifier:t,type:d,value:r}):M[l]={...M[l],value:r},n(P[P.length]={version:o,old_version:e,type:w,specifier:t,specifier_type:d,old_resolution:a,new_resolution:r});continue}case m:{let t=+O.node_id,d=k.findIndex(e=>e.id===t);if(d<0)throw error("invalid node_id");let r=k[d].data,l=null==O.new_node_data?null:O.new_node_data;if(i(l,r))break;k===this.nodes&&(k=k.slice()),k[d]=new Node(t,k[d].value,k[d].pinned,k[d].mode,l,k[d].name,k[d].combinePrevious,k[d].display),n(P[P.length]={version:o,old_version:e,node_id:t,type:O.type,old_node_data:r,new_node_data:l});continue}case y:{let i=+O.node_id,t=k.findIndex(e=>e.id===i);if(t<0)throw error("invalid node_id");let d=k[t].name,r=null==O.new_node_name?null:O.new_node_name+"";if(d===r)break;k===this.nodes&&(k=k.slice()),k[t]=new Node(i,k[t].value,k[t].pinned,k[t].mode,k[t].data,r,k[t].combinePrevious,k[t].display),n(P[P.length]={version:o,old_version:e,type:O.type,node_id:i,new_node_name:r,old_node_name:d});continue}case b:break;case d:throw error("cannot apply create");default:throw error("unknown type")}n(P[P.length]={version:o,old_version:e,type:b})}return P===this.events?this:new Model({version:o,title:t,nodes:k,events:P,license:g,copyright:x,resolutions:M})},writable:!0,configurable:!0},diff:{value:function(e,n=intersect(e,this)){let o=new Map(this.nodes.map(e=>[e.id,e])),i=new Map(e.nodes.map(e=>[e.id,e])),t=new Map(n),d=flip(n),a=e.nodes.map(e=>{let n=d.get(e.id),i=o.get(n);return i?{type:i.value===e.value?b:l,base:i,target:e}:{type:null==n?r:s,target:e}});e:for(let e=0,n=this.nodes.length;e<n;++e){let o=this.nodes[e],d=t.get(o.id);if(i.has(d))continue;let l={type:null==d?r:s,base:o};for(let o=e+1;o<n;++o){let e=i.get(t.get(this.nodes[o].id));if(e){a.splice(a.findIndex(n=>n.target===e),0,l);continue e}}a.push(l)}return a},writable:!0,configurable:!0},merge:{value:function(e,n){var o;let t,d;if(Array.isArray(e)||(e=Array.from(e)),n&&(o=n,n=function(e){o(redo_event(e))}),0===e.length)return[this,new Map];let v=+e[0].version,g=e.length,x=this.version-v+1,k=Math.min(g,x),P=this.reset(v-1,n).apply(e,n);for(t=0,e=P.events.slice(v);t<k;++t){let n=e[t],o=this.events[n.version];if(n.type===r&&n.node_id===n.version||n.type!==o.type||n.specifier!==o.specifier||n.specifier_type!==o.specifier_type||n.new_resolution!==o.new_resolution||n.node_id!==o.node_id||n.new_node_value!==o.new_node_value||n.new_node_pinned!==o.new_node_pinned||n.new_next_node_id!==o.new_next_node_id||n.new_node_mode!==o.new_node_mode||n.new_node_name!==o.new_node_name||n.new_combine!==o.new_combine||!i(n.new_node_display,o.new_node_display)||!i(n.new_node_data,o.new_node_data))break}if(t===g)return[this,new Map];if(t===x)return[P,new Map];let M=new Set,O=new Map;for(d=t;d<g;++d){let n=e[d];switch(n.type){case r:n.node_id<v&&M.add(n.node_id),O.delete(n.node_id);break;case s:M.delete(n.node_id),O.set(n.node_id,n.old_next_node_id)}}let j=new Map,N=[];for(d=v+t;d<=this.version;++d){let e=this.events[d];switch(e.type){case a:N.push({type:a,new_node_value:e.new_node_value});break;case r:{let n=e.node_id;j.has(n)?n=j.get(n):(n>=v||M.has(n))&&j.set(n,n=P.version+N.length+1);let o=e.new_next_node_id;if(j.has(o))o=j.get(o);else for(;O.has(o);)o=O.get(o);O.delete(n),N.push({type:r,node_id:n,new_node_value:e.new_node_value,new_node_pinned:e.new_node_pinned,new_next_node_id:o,new_node_mode:e.new_node_mode,new_node_data:e.new_node_data,new_node_name:e.new_node_name,...e.new_combine?{new_combine:e.new_combine}:null,...e.new_node_display?{new_node_display:e.new_node_display}:null});break}case l:{let n=e.node_id;if(j.has(n))n=j.get(n);else if(O.has(n))break;N.push({type:l,node_id:n,new_node_value:e.new_node_value});break}case _:{let n=e.node_id;if(j.has(n))n=j.get(n);else if(O.has(n))break;let o=e.new_next_node_id;if(j.has(o))o=j.get(o);else for(;O.has(o);)o=O.get(o);N.push({type:_,node_id:n,new_next_node_id:o,...e.new_combine?{new_combine:e.new_combine}:null,...e.new_node_display?{new_node_display:e.new_node_display}:null});break}case s:{let n=e.node_id;if(j.has(n))n=j.get(n);else if(O.has(n))break;M.delete(n),N.push({type:s,node_id:n});break}case u:case p:{let n=e.node_id;if(j.has(n))n=j.get(n);else if(O.has(n))break;N.push({type:e.type,node_id:n});break}case h:{let n=e.node_id;if(j.has(n))n=j.get(n);else if(O.has(n))break;N.push({type:e.type,node_id:n,new_node_mode:e.new_node_mode,new_node_pinned:e.new_node_pinned,new_node_value:e.new_node_value,new_node_data:e.new_node_data,new_node_name:e.new_node_name});break}case m:{let n=e.node_id;if(j.has(n))n=j.get(n);else if(O.has(n))break;N.push({type:e.type,node_id:n,new_node_data:e.new_node_data});break}case y:{let n=e.node_id;if(j.has(n))n=j.get(n);else if(O.has(n))break;N.push({type:e.type,node_id:n,new_node_name:e.new_node_name});break}case c:N.push({type:c,new_node_value:e.new_node_value});break;case f:N.push({type:f,new_node_value:e.new_node_value});break;case w:N.push({type:w,specifier:e.specifier,specifier_type:e.specifier_type,new_resolution:e.new_resolution});break;case b:break;default:throw error("unknown type")}}return[P.apply(N,n),j]},writable:!0,configurable:!0},patch:{value:function(e,n=intersect(e,this)){let o;let t=new Map(this.nodes.map(e=>[e.id,e])),d=new Map(this.nodes.slice(0,-1).map((e,n)=>[e.id,this.nodes[n+1].id])),v=new Map(this.nodes.slice(1).map((e,n)=>[e.id,this.nodes[n].id])),b=new Map(n),g=flip(n),x=this.nodes.length?this.nodes[this.nodes.length-1].id:void 0,k=new Set(e.nodes.map(e=>e.id)),P=[],M=new Map,O=this.events.length-1;for(let{id:n}of(this.title!==e.title&&(++O,P.push({type:a,new_node_value:e.title})),this.license!==e.license&&(++O,P.push({type:c,new_node_value:e.license})),this.copyright!==e.copyright&&(++O,P.push({type:f,new_node_value:e.copyright})),this.nodes))if(!k.has(b.get(n))){++O,P.push({type:s,node_id:n});let e=v.get(n),o=d.get(n);void 0!==o?(d.set(n,d.get(o)),v.set(o,e)):x=e,void 0!==e&&(v.set(n,v.get(e)),d.set(e,o))}for(let n=e.nodes.length-1;n>=0;--n){let o=e.nodes[n],a=e.nodes[n+1]&&g.get(e.nodes[n+1].id),{id:s}=o,w=g.get(s),c=t.get(w);if(c){c.mode!==o.mode?(++O,P.push({type:h,node_id:w,new_node_mode:o.mode,new_node_value:o.value,new_node_pinned:o.pinned,new_node_name:o.name,new_node_data:o.data})):(c.value!==o.value&&(++O,P.push({type:l,node_id:w,new_node_value:o.value})),c.pinned!==o.pinned&&(++O,P.push({type:o.pinned?u:p,node_id:w})),c.name!==o.name&&(++O,P.push({type:y,node_id:w,new_node_name:o.name})),i(c.data,o.data)||(++O,P.push({type:m,node_id:w,new_node_data:o.data})));let e=d.get(w);if(e!==a){++O,P.push({type:_,node_id:w,new_next_node_id:void 0===a?null:a});let n=v.get(w),o=void 0!==a?v.get(a):x;void 0!==n&&d.set(n,e),void 0!==e&&v.set(e,n),d.set(w,a),v.set(w,o),void 0!==o&&d.set(o,w),void 0!==a?v.set(a,w):x=w}}else{let e=++O;null==w&&(w=e,g.set(s,w),b.set(w,s),M.set(w,s)),P.push({type:r,node_id:w,new_node_value:o.value,new_node_pinned:o.pinned,new_next_node_id:void 0===a?null:a,new_node_mode:o.mode,new_node_data:o.data,new_node_name:o.name});let n=void 0!=a?v.get(a):x;void 0!=n&&d.set(n,w),void 0!=a?v.set(a,w):x=w,d.set(w,a),v.set(w,n)}}let{nodes:j}=this.apply(P);for(let n=j.length-1;n>=0;--n){let t=j[n],d=j[n+1],r=e.nodes[n];if(i(t.display,r.display)||(++O,P.push({type:_,node_id:t.id,new_next_node_id:d?d.id:null,new_node_display:r.display})),0===n)continue;let l=j[n-1];void 0===o&&(o=!!t.combinePrevious||null),o!=r.combinePrevious?(++O,P.push({type:_,node_id:l.id,new_next_node_id:t.id,new_combine:r.combinePrevious?"next":null}),o=!1):o=l.combinePrevious}let N=resolution_map(this.resolutions);for(let n of e.resolutions){let e=N.get(resolution_key(n));e!==n.value&&P.push({type:w,specifier:n.specifier,specifier_type:n.type,new_resolution:n.value})}let C=resolution_map(e.resolutions);for(let e of this.resolutions)C.has(resolution_key(e))||P.push({type:w,specifier:e.specifier,specifier_type:e.type,new_resolution:null});return[P,M]},writable:!0,configurable:!0},reset:{value:function(e,n){if((e=+e)<0||e>=this.events.length||e!==(0|e))throw error("invalid version");if(e===this.events.length-1)return this;let o=Array.from(function* reset_events(e,n,o){for(;o<n;){let i=e[n--];if("revert"===i.type){let{old_version:n,node_id:t}=i;if(n<=o)return yield*reset_events(e,t,o);yield*reset_events(e,t,n)}else{let e=function(e){if(void 0===e)throw error("insufficient history");let{old_version:n,type:o,node_id:i,old_node_value:t,old_node_pinned:g,old_next_node_id:x,old_node_mode:k,old_node_data:P,old_node_name:M,specifier:O,specifier_type:j,old_resolution:N,old_combine:C,old_node_display:I}=e;switch(o){case a:return{version:n,type:o,new_node_value:t};case r:return{version:n,type:s,node_id:i};case s:return{version:n,type:r,node_id:i,new_node_value:t,new_node_pinned:g,new_next_node_id:x,new_node_mode:k,new_node_data:P,new_node_name:M,new_combine:C,new_node_display:I};case _:return{version:n,type:o,node_id:i,new_next_node_id:x,new_combine:C,new_node_display:I};case l:return{version:n,type:o,node_id:i,new_node_value:t};case u:return{version:n,type:p,node_id:i};case p:return{version:n,type:u,node_id:i};case c:case f:return{version:n,type:o,new_node_value:t};case h:return{version:n,type:o,node_id:i,new_node_mode:k,new_node_value:t,new_node_pinned:g,new_node_data:P,new_node_name:M};case m:return{version:n,type:o,node_id:i,new_node_data:P};case y:return{version:n,type:o,node_id:i,new_node_name:M};case w:return{version:n,type:o,specifier:O,specifier_type:j,new_resolution:N};case b:return{version:n,type:o};case d:throw error("cannot undo create");case v:throw error("cannot undo revert");default:throw error("unknown type")}}(i);if(yield e,e.version===o)return}}for(;n<o;){let i=e[++n];if("revert"===i.type){let{old_version:n,node_id:t}=i;if(t>=o)return yield*reset_events(e,n,o);yield*reset_events(e,n,t)}else{let e=redo_event(i);if(yield e,e.version===o)return}}}(this.events,this.version,e));n&&o.forEach(n);let{title:i,license:t,copyright:g,nodes:x,resolutions:k}=this.apply(o);return o.length&&(e=o[o.length-1].version),new Model({version:e,title:i,license:t,copyright:g,nodes:x,events:this.events.slice(0,e+1),resolutions:k})},writable:!0,configurable:!0},resolve:{value:function(e,n){if(null==e)throw error(`invalid specifier type: ${e}`);if(null==n)throw error(`invalid specifier: ${n}`);return resolution_map(this.resolutions).get(resolution_key({type:e,specifier:n}))},writable:!0,configurable:!0}})}}]);